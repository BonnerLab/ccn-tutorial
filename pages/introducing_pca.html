<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.330">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-08-26">

<title>CCN 2023 | Tutorial - An introduction to PCA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="..//resources/ccn-logo.svg" rel="icon" type="image/svg+xml">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 20,
  "keyboard-shortcut": [
    null
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../resources/ccn-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">CCN 2023 | Tutorial</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../pages/introducing_pca.html" aria-current="page"> 
<span class="menu-text">Introducing PCA</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../pages/exploring_neural_data.html"> 
<span class="menu-text">Exploring neural data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../pages/dealing_with_noise.html"> 
<span class="menu-text">Dealing with noise</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../pages/comparing_representations.html"> 
<span class="menu-text">Comparing representations</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../pages/analyzing_neural_networks.html"> 
<span class="menu-text">Analyzing neural networks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../pages/reference.html"> 
<span class="menu-text">Reference</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
    <a href="https://github.com/BonnerLab/ccn-tutorial" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">An introduction to PCA</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button" data-quarto-source-url="https://github.com/BonnerLab/ccn-tutorial/blob/main/pages/introducing_pca.qmd">View Source</a></li></ul></div></div>
            <p class="subtitle lead">Using principal component analysis to reveal latent structure in data</p>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 26, 2023</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">August 25, 2023</p>
      </div>
    </div>
      
    </div>
    
  <div>
    <div class="abstract">
      <div class="block-title">Summary</div>
      PCA is often used to reduce the dimensionality of large data while preserving a significant amount of variance. More fundamentally, it is a framework for studying the covariance statistics of data. In this section, we will introduce the concept of PCA with some toy examples.
    </div>
  </div>
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="1">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#a-simple-experiment" id="toc-a-simple-experiment" class="nav-link active" data-scroll-target="#a-simple-experiment">A simple experiment</a>
  <ul>
  <li><a href="#creating-the-stimuli" id="toc-creating-the-stimuli" class="nav-link" data-scroll-target="#creating-the-stimuli">Creating the stimuli</a></li>
  <li><a href="#simulating-neural-responses" id="toc-simulating-neural-responses" class="nav-link" data-scroll-target="#simulating-neural-responses">Simulating neural responses</a></li>
  </ul></li>
  <li><a href="#understanding-the-neural-code" id="toc-understanding-the-neural-code" class="nav-link" data-scroll-target="#understanding-the-neural-code">Understanding the neural code</a></li>
  <li><a href="#studying-the-latent-dimensions" id="toc-studying-the-latent-dimensions" class="nav-link" data-scroll-target="#studying-the-latent-dimensions">Studying the latent dimensions</a>
  <ul>
  <li><a href="#some-geometric-intuition" id="toc-some-geometric-intuition" class="nav-link" data-scroll-target="#some-geometric-intuition">Some geometric intuition</a></li>
  <li><a href="#the-mathematical-definition" id="toc-the-mathematical-definition" class="nav-link" data-scroll-target="#the-mathematical-definition">The mathematical definition</a></li>
  <li><a href="#a-computational-recipe" id="toc-a-computational-recipe" class="nav-link" data-scroll-target="#a-computational-recipe">A computational recipe</a></li>
  </ul></li>
  <li><a href="#transforming-the-dataset" id="toc-transforming-the-dataset" class="nav-link" data-scroll-target="#transforming-the-dataset">Transforming the dataset</a>
  <ul>
  <li><a href="#inspecting-the-eigenvectors" id="toc-inspecting-the-eigenvectors" class="nav-link" data-scroll-target="#inspecting-the-eigenvectors">Inspecting the eigenvectors</a></li>
  <li><a href="#interpreting-the-transformed-data" id="toc-interpreting-the-transformed-data" class="nav-link" data-scroll-target="#interpreting-the-transformed-data">Interpreting the transformed data</a></li>
  <li><a href="#inspecting-the-eigenspectrum" id="toc-inspecting-the-eigenspectrum" class="nav-link" data-scroll-target="#inspecting-the-eigenspectrum">Inspecting the eigenspectrum</a></li>
  </ul></li>
  <li><a href="#quantifying-dimensionality" id="toc-quantifying-dimensionality" class="nav-link" data-scroll-target="#quantifying-dimensionality">Quantifying dimensionality</a>
  <ul>
  <li><a href="#rank-of-the-covariance-matrix" id="toc-rank-of-the-covariance-matrix" class="nav-link" data-scroll-target="#rank-of-the-covariance-matrix">Rank of the covariance matrix</a></li>
  <li><a href="#setting-an-arbitrary-variance-threshold" id="toc-setting-an-arbitrary-variance-threshold" class="nav-link" data-scroll-target="#setting-an-arbitrary-variance-threshold">Setting an arbitrary variance threshold</a></li>
  <li><a href="#setting-an-arbitrary-cumulative-variance-threshold" id="toc-setting-an-arbitrary-cumulative-variance-threshold" class="nav-link" data-scroll-target="#setting-an-arbitrary-cumulative-variance-threshold">Setting an arbitrary <em>cumulative</em> variance threshold</a></li>
  <li><a href="#eyeballing-the-knee-of-the-spectrum" id="toc-eyeballing-the-knee-of-the-spectrum" class="nav-link" data-scroll-target="#eyeballing-the-knee-of-the-spectrum">Eyeballing the “knee” of the spectrum</a></li>
  <li><a href="#computing-a-summary-statistic-over-the-entire-spectrum" id="toc-computing-a-summary-statistic-over-the-entire-spectrum" class="nav-link" data-scroll-target="#computing-a-summary-statistic-over-the-entire-spectrum">Computing a summary statistic over the entire spectrum</a></li>
  </ul></li>
  <li><a href="#takeaways-and-further-thoughts" id="toc-takeaways-and-further-thoughts" class="nav-link" data-scroll-target="#takeaways-and-further-thoughts">Takeaways and further thoughts</a></li>
  <li><a href="#additional-notes" id="toc-additional-notes" class="nav-link" data-scroll-target="#additional-notes">Additional notes</a>
  <ul>
  <li><a href="#preprocessing-the-data" id="toc-preprocessing-the-data" class="nav-link" data-scroll-target="#preprocessing-the-data">Preprocessing the data</a></li>
  </ul></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading">Further reading</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/BonnerLab/ccn-tutorial/edit/main/pages/introducing_pca.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/BonnerLab/ccn-tutorial/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="introducing_pca.ipynb" download="introducing_pca.ipynb"><i class="bi bi-journal-code"></i>Jupyter</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Run this notebook interactively!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Here’s a <a href="https://colab.research.google.com/github/BonnerLab/ccn-tutorial/blob/main/notebooks/introducing_pca.ipynb">link to this notebook</a> on Google Colab.</p>
</div>
</div>
<section id="a-simple-experiment" class="level2">
<h2 class="anchored" data-anchor-id="a-simple-experiment">A simple experiment</h2>
<p>Let’s perform an imaginary neuroscience experiment! We’ll record voltages from <span class="math inline">P = 2</span> neurons in visual cortex while the participant passively views <span class="math inline">N = 1000</span> dots of different <em>colors</em> and <em>sizes</em>.</p>
<div id="install_package" class="cell" data-execution_count="2">
<details>
<summary>Install all required dependencies</summary>
<div class="sourceCode cell-code" id="install_package"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="install_package-1"><a href="#install_package-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co"> uncomment before final packaging</span></span>
<span id="install_package-2"><a href="#install_package-2" aria-hidden="true" tabindex="-1"></a><span class="co"># %pip install git+https://github.com/BonnerLab/ccn-tutorial.git</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="import_libraries" class="cell" data-execution_count="3">
<details>
<summary>Import various libraries</summary>
<div class="sourceCode cell-code" id="import_libraries"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="import_libraries-1"><a href="#import_libraries-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections.abc <span class="im">import</span> Sequence, Callable</span>
<span id="import_libraries-2"><a href="#import_libraries-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="import_libraries-3"><a href="#import_libraries-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> NamedTuple</span>
<span id="import_libraries-4"><a href="#import_libraries-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="import_libraries-5"><a href="#import_libraries-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="import_libraries-6"><a href="#import_libraries-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="import_libraries-7"><a href="#import_libraries-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="import_libraries-8"><a href="#import_libraries-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="import_libraries-9"><a href="#import_libraries-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="import_libraries-10"><a href="#import_libraries-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.figure <span class="im">import</span> Figure</span>
<span id="import_libraries-11"><a href="#import_libraries-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.ticker <span class="im">as</span> ticker</span>
<span id="import_libraries-12"><a href="#import_libraries-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.animation <span class="im">import</span> FuncAnimation</span>
<span id="import_libraries-13"><a href="#import_libraries-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib_inline.backend_inline <span class="im">import</span> set_matplotlib_formats</span>
<span id="import_libraries-14"><a href="#import_libraries-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ipywidgets <span class="im">as</span> widgets</span>
<span id="import_libraries-15"><a href="#import_libraries-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display, HTML</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="import-utility-functions" class="cell" data-execution_count="4">
<details>
<summary>Import utility functions</summary>
<div class="sourceCode cell-code" id="import-utility-functions"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="import-utility-functions-1"><a href="#import-utility-functions-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> utilities.toy_example <span class="im">import</span> (</span>
<span id="import-utility-functions-2"><a href="#import-utility-functions-2" aria-hidden="true" tabindex="-1"></a>    create_stimuli,</span>
<span id="import-utility-functions-3"><a href="#import-utility-functions-3" aria-hidden="true" tabindex="-1"></a>    Neuron,</span>
<span id="import-utility-functions-4"><a href="#import-utility-functions-4" aria-hidden="true" tabindex="-1"></a>    simulate_neuron_responses,</span>
<span id="import-utility-functions-5"><a href="#import-utility-functions-5" aria-hidden="true" tabindex="-1"></a>    simulate_multiple_neuron_responses,</span>
<span id="import-utility-functions-6"><a href="#import-utility-functions-6" aria-hidden="true" tabindex="-1"></a>    view_individual_scatter,</span>
<span id="import-utility-functions-7"><a href="#import-utility-functions-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="set_visualization_defaults" class="cell" data-execution_count="5">
<details>
<summary>Set some visualization defaults</summary>
<div class="sourceCode cell-code" id="set_visualization_defaults"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="set_visualization_defaults-1"><a href="#set_visualization_defaults-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="set_visualization_defaults-2"><a href="#set_visualization_defaults-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="set_visualization_defaults-3"><a href="#set_visualization_defaults-3" aria-hidden="true" tabindex="-1"></a>sns.set_theme(</span>
<span id="set_visualization_defaults-4"><a href="#set_visualization_defaults-4" aria-hidden="true" tabindex="-1"></a>    context<span class="op">=</span><span class="st">"notebook"</span>,</span>
<span id="set_visualization_defaults-5"><a href="#set_visualization_defaults-5" aria-hidden="true" tabindex="-1"></a>    style<span class="op">=</span><span class="st">"white"</span>,</span>
<span id="set_visualization_defaults-6"><a href="#set_visualization_defaults-6" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span><span class="st">"deep"</span>,</span>
<span id="set_visualization_defaults-7"><a href="#set_visualization_defaults-7" aria-hidden="true" tabindex="-1"></a>    rc<span class="op">=</span>{<span class="st">"legend.edgecolor"</span>: <span class="st">"None"</span>},</span>
<span id="set_visualization_defaults-8"><a href="#set_visualization_defaults-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="set_visualization_defaults-9"><a href="#set_visualization_defaults-9" aria-hidden="true" tabindex="-1"></a>set_matplotlib_formats(<span class="st">"svg"</span>)</span>
<span id="set_visualization_defaults-10"><a href="#set_visualization_defaults-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="set_visualization_defaults-11"><a href="#set_visualization_defaults-11" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">"display.max_rows"</span>, <span class="dv">5</span>)</span>
<span id="set_visualization_defaults-12"><a href="#set_visualization_defaults-12" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">"display.max_columns"</span>, <span class="dv">10</span>)</span>
<span id="set_visualization_defaults-13"><a href="#set_visualization_defaults-13" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">"display.precision"</span>, <span class="dv">3</span>)</span>
<span id="set_visualization_defaults-14"><a href="#set_visualization_defaults-14" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">"display.show_dimensions"</span>, <span class="va">False</span>)</span>
<span id="set_visualization_defaults-15"><a href="#set_visualization_defaults-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="set_visualization_defaults-16"><a href="#set_visualization_defaults-16" aria-hidden="true" tabindex="-1"></a>xr.set_options(display_max_rows<span class="op">=</span><span class="dv">3</span>, display_expand_data<span class="op">=</span><span class="va">False</span>)</span>
<span id="set_visualization_defaults-17"><a href="#set_visualization_defaults-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="set_visualization_defaults-18"><a href="#set_visualization_defaults-18" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="initialize_rng" class="cell" data-execution_count="6">
<details>
<summary>Initialize a deterministic random number generator</summary>
<div class="sourceCode cell-code" id="initialize_rng"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="initialize_rng-1"><a href="#initialize_rng-1" aria-hidden="true" tabindex="-1"></a>random_state <span class="op">=</span> <span class="dv">0</span></span>
<span id="initialize_rng-2"><a href="#initialize_rng-2" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> np.random.default_rng(seed<span class="op">=</span>random_state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="creating-the-stimuli" class="level3">
<h3 class="anchored" data-anchor-id="creating-the-stimuli">Creating the stimuli</h3>
<p>Let’s create <span class="math inline">N = 1000</span> dots of different <em>colors</em> and <em>sizes</em>. From the scatterplot, we can see that the two latent variables are <a href="../pages/reference.html#correlation">uncorrelated</a>.</p>
<div id="419931d2" class="cell" data-add-from="../src/utilities/toy_example.py" data-code-filename="(Function) Create stimulus dots of various colors and sizes" data-end-line="31" data-source-lang="python" data-start-line="21" data-execution_count="7">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="419931d2" data-startfrom="21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python" style="counter-reset: source-line 20;"><span id="419931d2-21"><a href="#419931d2-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_stimuli(</span>
<span id="419931d2-22"><a href="#419931d2-22" aria-hidden="true" tabindex="-1"></a>    n: <span class="bu">int</span>,</span>
<span id="419931d2-23"><a href="#419931d2-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>,</span>
<span id="419931d2-24"><a href="#419931d2-24" aria-hidden="true" tabindex="-1"></a>    rng: np.random.Generator,</span>
<span id="419931d2-25"><a href="#419931d2-25" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="419931d2-26"><a href="#419931d2-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(</span>
<span id="419931d2-27"><a href="#419931d2-27" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="419931d2-28"><a href="#419931d2-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">"color"</span>: rng.random(size<span class="op">=</span>(n,)),</span>
<span id="419931d2-29"><a href="#419931d2-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">"size"</span>: rng.random(size<span class="op">=</span>(n,)),</span>
<span id="419931d2-30"><a href="#419931d2-30" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="419931d2-31"><a href="#419931d2-31" aria-hidden="true" tabindex="-1"></a>    ).set_index(<span class="dv">1</span> <span class="op">+</span> np.arange(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-create_the_stimuli" class="cell" data-execution_count="8">
<details>
<summary>Visualize the stimuli</summary>
<div class="sourceCode cell-code" id="cell-create_the_stimuli"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cell-create_the_stimuli-1"><a href="#cell-create_the_stimuli-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> view_stimuli(data: pd.DataFrame) <span class="op">-&gt;</span> Figure:</span>
<span id="cell-create_the_stimuli-2"><a href="#cell-create_the_stimuli-2" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cell-create_the_stimuli-3"><a href="#cell-create_the_stimuli-3" aria-hidden="true" tabindex="-1"></a>    sns.scatterplot(</span>
<span id="cell-create_the_stimuli-4"><a href="#cell-create_the_stimuli-4" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>ax,</span>
<span id="cell-create_the_stimuli-5"><a href="#cell-create_the_stimuli-5" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>data,</span>
<span id="cell-create_the_stimuli-6"><a href="#cell-create_the_stimuli-6" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"color"</span>,</span>
<span id="cell-create_the_stimuli-7"><a href="#cell-create_the_stimuli-7" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"size"</span>,</span>
<span id="cell-create_the_stimuli-8"><a href="#cell-create_the_stimuli-8" aria-hidden="true" tabindex="-1"></a>        hue<span class="op">=</span><span class="st">"color"</span>,</span>
<span id="cell-create_the_stimuli-9"><a href="#cell-create_the_stimuli-9" aria-hidden="true" tabindex="-1"></a>        size<span class="op">=</span><span class="st">"size"</span>,</span>
<span id="cell-create_the_stimuli-10"><a href="#cell-create_the_stimuli-10" aria-hidden="true" tabindex="-1"></a>        palette<span class="op">=</span><span class="st">"flare"</span>,</span>
<span id="cell-create_the_stimuli-11"><a href="#cell-create_the_stimuli-11" aria-hidden="true" tabindex="-1"></a>        legend<span class="op">=</span><span class="va">False</span>,</span>
<span id="cell-create_the_stimuli-12"><a href="#cell-create_the_stimuli-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cell-create_the_stimuli-13"><a href="#cell-create_the_stimuli-13" aria-hidden="true" tabindex="-1"></a>    sns.despine(ax<span class="op">=</span>ax, trim<span class="op">=</span><span class="va">True</span>)</span>
<span id="cell-create_the_stimuli-14"><a href="#cell-create_the_stimuli-14" aria-hidden="true" tabindex="-1"></a>    fig.tight_layout()</span>
<span id="cell-create_the_stimuli-15"><a href="#cell-create_the_stimuli-15" aria-hidden="true" tabindex="-1"></a>    plt.close(fig)</span>
<span id="cell-create_the_stimuli-16"><a href="#cell-create_the_stimuli-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cell-create_the_stimuli-17"><a href="#cell-create_the_stimuli-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cell-create_the_stimuli-18"><a href="#cell-create_the_stimuli-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cell-create_the_stimuli-19"><a href="#cell-create_the_stimuli-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cell-create_the_stimuli-20"><a href="#cell-create_the_stimuli-20" aria-hidden="true" tabindex="-1"></a>stimuli <span class="op">=</span> create_stimuli(n<span class="op">=</span><span class="dv">1_000</span>, rng<span class="op">=</span>rng)</span>
<span id="cell-create_the_stimuli-21"><a href="#cell-create_the_stimuli-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cell-create_the_stimuli-22"><a href="#cell-create_the_stimuli-22" aria-hidden="true" tabindex="-1"></a>view_stimuli(stimuli)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="6">
<div id="create_the_stimuli" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="introducing_pca_files/figure-html/create_the_stimuli-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="simulating-neural-responses" class="level3">
<h3 class="anchored" data-anchor-id="simulating-neural-responses">Simulating neural responses</h3>
<p>Now, let’s simulate some neural data. We need to decide how the <span class="math inline">P = 2</span> neurons might respond to these <span class="math inline">N = 1000</span> stimulus dots. Each neuron could respond to either one or both of the latent features that define these stimuli – <span class="math inline">\text{color}</span> and <span class="math inline">\text{size}</span>. The neuron’s responses could also be subject to noise.</p>
<p>Here, we model each neuron’s response <span class="math inline">r_\text{neuron}</span> as a simple linear combination of the two latent features with stimulus-independent Gaussian noise <span class="math inline">\epsilon</span>:</p>
<p><span class="math inline">r_{\text{neuron}} \sim \beta_{\text{color}} \left( \text{color} \right) + \beta_{\text{size}} \left( \text{size} \right) + \epsilon</span>, where <span class="math inline">\epsilon \sim \mathcal{N}(\mu_{\text{neuron}}, \sigma_{\text{neuron}}^2)</span></p>
<div id="190d20ea" class="cell" data-add-from="../src/utilities/toy_example.py" data-code-filename="(Definition) Parameters controlling neuron responses" data-end-line="18" data-source-lang="python" data-start-line="12" data-execution_count="9">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="190d20ea" data-startfrom="12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python" style="counter-reset: source-line 11;"><span id="190d20ea-12"><a href="#190d20ea-12" aria-hidden="true" tabindex="-1"></a>Neuron <span class="op">=</span> NamedTuple(</span>
<span id="190d20ea-13"><a href="#190d20ea-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Neuron"</span>,</span>
<span id="190d20ea-14"><a href="#190d20ea-14" aria-hidden="true" tabindex="-1"></a>    beta_color<span class="op">=</span><span class="bu">float</span>,</span>
<span id="190d20ea-15"><a href="#190d20ea-15" aria-hidden="true" tabindex="-1"></a>    beta_size<span class="op">=</span><span class="bu">float</span>,</span>
<span id="190d20ea-16"><a href="#190d20ea-16" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">=</span><span class="bu">float</span>,</span>
<span id="190d20ea-17"><a href="#190d20ea-17" aria-hidden="true" tabindex="-1"></a>    std<span class="op">=</span><span class="bu">float</span>,</span>
<span id="190d20ea-18"><a href="#190d20ea-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>As we can see, each neuron’s response is completely defined by exactly four parameters:</p>
<ul>
<li><span class="math inline">\beta_{\text{color}}</span> – how much the neuron cares about the stimulus <span class="math inline">\text{color}</span></li>
<li><span class="math inline">\beta_{\text{size}}</span> – how much the neuron cares about the stimulus <span class="math inline">\text{size}</span></li>
<li><span class="math inline">\mu_{\text{neuron}}</span> – the mean of the neuron’s responses</li>
<li><span class="math inline">\sigma_{\text{neuron}}^2</span> – the stimulus-independent variance of the neuron’s responses</li>
</ul>
<div id="99958a48" class="cell" data-add-from="../src/utilities/toy_example.py" data-code-filename="(Function) Simulate neuron responses" data-end-line="48" data-source-lang="python" data-start-line="34" data-execution_count="10">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="99958a48" data-startfrom="34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python" style="counter-reset: source-line 33;"><span id="99958a48-34"><a href="#99958a48-34" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simulate_neuron_responses(</span>
<span id="99958a48-35"><a href="#99958a48-35" aria-hidden="true" tabindex="-1"></a>    stimuli: pd.DataFrame,</span>
<span id="99958a48-36"><a href="#99958a48-36" aria-hidden="true" tabindex="-1"></a>    neuron: Neuron,</span>
<span id="99958a48-37"><a href="#99958a48-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>,</span>
<span id="99958a48-38"><a href="#99958a48-38" aria-hidden="true" tabindex="-1"></a>    rng: np.random.Generator,</span>
<span id="99958a48-39"><a href="#99958a48-39" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="99958a48-40"><a href="#99958a48-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> z_score(x: np.ndarray) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="99958a48-41"><a href="#99958a48-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (x <span class="op">-</span> x.mean()) <span class="op">/</span> x.std()</span>
<span id="99958a48-42"><a href="#99958a48-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="99958a48-43"><a href="#99958a48-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="99958a48-44"><a href="#99958a48-44" aria-hidden="true" tabindex="-1"></a>        neuron.beta_color <span class="op">*</span> z_score(stimuli[<span class="st">"color"</span>])</span>
<span id="99958a48-45"><a href="#99958a48-45" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> neuron.beta_size <span class="op">*</span> z_score(stimuli[<span class="st">"size"</span>])</span>
<span id="99958a48-46"><a href="#99958a48-46" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> neuron.std <span class="op">*</span> rng.standard_normal(size<span class="op">=</span>(<span class="bu">len</span>(stimuli),))</span>
<span id="99958a48-47"><a href="#99958a48-47" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> neuron.mean</span>
<span id="99958a48-48"><a href="#99958a48-48" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="1852a540" class="cell" data-add-from="../src/utilities/toy_example.py" data-code-filename="(Function) Simulate multiple neurons' responses" data-end-line="85" data-source-lang="python" data-start-line="51" data-execution_count="11">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="1852a540" data-startfrom="51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python" style="counter-reset: source-line 50;"><span id="1852a540-51"><a href="#1852a540-51" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simulate_multiple_neuron_responses(</span>
<span id="1852a540-52"><a href="#1852a540-52" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>,</span>
<span id="1852a540-53"><a href="#1852a540-53" aria-hidden="true" tabindex="-1"></a>    stimuli: pd.DataFrame,</span>
<span id="1852a540-54"><a href="#1852a540-54" aria-hidden="true" tabindex="-1"></a>    neurons: Sequence[Neuron],</span>
<span id="1852a540-55"><a href="#1852a540-55" aria-hidden="true" tabindex="-1"></a>    rng: np.random.Generator,</span>
<span id="1852a540-56"><a href="#1852a540-56" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> xr.DataArray:</span>
<span id="1852a540-57"><a href="#1852a540-57" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> []</span>
<span id="1852a540-58"><a href="#1852a540-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i_neuron, neuron <span class="kw">in</span> <span class="bu">enumerate</span>(neurons):</span>
<span id="1852a540-59"><a href="#1852a540-59" aria-hidden="true" tabindex="-1"></a>        data.append(</span>
<span id="1852a540-60"><a href="#1852a540-60" aria-hidden="true" tabindex="-1"></a>            xr.DataArray(</span>
<span id="1852a540-61"><a href="#1852a540-61" aria-hidden="true" tabindex="-1"></a>                data<span class="op">=</span>simulate_neuron_responses(</span>
<span id="1852a540-62"><a href="#1852a540-62" aria-hidden="true" tabindex="-1"></a>                    stimuli<span class="op">=</span>stimuli,</span>
<span id="1852a540-63"><a href="#1852a540-63" aria-hidden="true" tabindex="-1"></a>                    neuron<span class="op">=</span>neuron,</span>
<span id="1852a540-64"><a href="#1852a540-64" aria-hidden="true" tabindex="-1"></a>                    rng<span class="op">=</span>rng,</span>
<span id="1852a540-65"><a href="#1852a540-65" aria-hidden="true" tabindex="-1"></a>                ),</span>
<span id="1852a540-66"><a href="#1852a540-66" aria-hidden="true" tabindex="-1"></a>                dims<span class="op">=</span>(<span class="st">"stimulus"</span>,),</span>
<span id="1852a540-67"><a href="#1852a540-67" aria-hidden="true" tabindex="-1"></a>                coords<span class="op">=</span>{</span>
<span id="1852a540-68"><a href="#1852a540-68" aria-hidden="true" tabindex="-1"></a>                    column: (<span class="st">"stimulus"</span>, values)</span>
<span id="1852a540-69"><a href="#1852a540-69" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> column, values <span class="kw">in</span> stimuli.reset_index(names<span class="op">=</span><span class="st">"stimulus"</span>).items()</span>
<span id="1852a540-70"><a href="#1852a540-70" aria-hidden="true" tabindex="-1"></a>                },</span>
<span id="1852a540-71"><a href="#1852a540-71" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="1852a540-72"><a href="#1852a540-72" aria-hidden="true" tabindex="-1"></a>            .expand_dims({<span class="st">"neuron"</span>: [i_neuron <span class="op">+</span> <span class="dv">1</span>]})</span>
<span id="1852a540-73"><a href="#1852a540-73" aria-hidden="true" tabindex="-1"></a>            .assign_coords(</span>
<span id="1852a540-74"><a href="#1852a540-74" aria-hidden="true" tabindex="-1"></a>                {</span>
<span id="1852a540-75"><a href="#1852a540-75" aria-hidden="true" tabindex="-1"></a>                    field: (<span class="st">"neuron"</span>, [<span class="bu">float</span>(value)])</span>
<span id="1852a540-76"><a href="#1852a540-76" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> field, value <span class="kw">in</span> neuron._asdict().items()</span>
<span id="1852a540-77"><a href="#1852a540-77" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="1852a540-78"><a href="#1852a540-78" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="1852a540-79"><a href="#1852a540-79" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="1852a540-80"><a href="#1852a540-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="1852a540-81"><a href="#1852a540-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="1852a540-82"><a href="#1852a540-82" aria-hidden="true" tabindex="-1"></a>        xr.concat(data, dim<span class="op">=</span><span class="st">"neuron"</span>)</span>
<span id="1852a540-83"><a href="#1852a540-83" aria-hidden="true" tabindex="-1"></a>        .rename(<span class="st">"neuron responses"</span>)</span>
<span id="1852a540-84"><a href="#1852a540-84" aria-hidden="true" tabindex="-1"></a>        .transpose(<span class="st">"stimulus"</span>, <span class="st">"neuron"</span>)</span>
<span id="1852a540-85"><a href="#1852a540-85" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This procedure produces a data matrix <span class="math inline">X \in \mathbb{R}^{N \times P}</span> containing the <span class="math inline">P = 2</span> neurons’ responses to the <span class="math inline">N = 1000</span> stimuli.</p>
<div id="cell-simulate_the_neuron_responses" class="cell" data-execution_count="12">
<details open="">
<summary>Simulate the responses of two neurons to the stimuli</summary>
<div class="sourceCode cell-code" id="cell-simulate_the_neuron_responses"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cell-simulate_the_neuron_responses-1"><a href="#cell-simulate_the_neuron_responses-1" aria-hidden="true" tabindex="-1"></a>neurons <span class="op">=</span> (</span>
<span id="cell-simulate_the_neuron_responses-2"><a href="#cell-simulate_the_neuron_responses-2" aria-hidden="true" tabindex="-1"></a>    Neuron(beta_color<span class="op">=</span><span class="dv">3</span>, beta_size<span class="op">=-</span><span class="dv">2</span>, std<span class="op">=</span><span class="dv">1</span>, mean<span class="op">=</span><span class="dv">7</span>),</span>
<span id="cell-simulate_the_neuron_responses-3"><a href="#cell-simulate_the_neuron_responses-3" aria-hidden="true" tabindex="-1"></a>    Neuron(beta_color<span class="op">=-</span><span class="dv">2</span>, beta_size<span class="op">=</span><span class="dv">5</span>, std<span class="op">=</span><span class="dv">3</span>, mean<span class="op">=-</span><span class="dv">6</span>),</span>
<span id="cell-simulate_the_neuron_responses-4"><a href="#cell-simulate_the_neuron_responses-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cell-simulate_the_neuron_responses-5"><a href="#cell-simulate_the_neuron_responses-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cell-simulate_the_neuron_responses-6"><a href="#cell-simulate_the_neuron_responses-6" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> simulate_multiple_neuron_responses(</span>
<span id="cell-simulate_the_neuron_responses-7"><a href="#cell-simulate_the_neuron_responses-7" aria-hidden="true" tabindex="-1"></a>    stimuli<span class="op">=</span>stimuli,</span>
<span id="cell-simulate_the_neuron_responses-8"><a href="#cell-simulate_the_neuron_responses-8" aria-hidden="true" tabindex="-1"></a>    neurons<span class="op">=</span>neurons,</span>
<span id="cell-simulate_the_neuron_responses-9"><a href="#cell-simulate_the_neuron_responses-9" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">=</span>rng,</span>
<span id="cell-simulate_the_neuron_responses-10"><a href="#cell-simulate_the_neuron_responses-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cell-simulate_the_neuron_responses-11"><a href="#cell-simulate_the_neuron_responses-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cell-simulate_the_neuron_responses-12"><a href="#cell-simulate_the_neuron_responses-12" aria-hidden="true" tabindex="-1"></a>display(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="simulate_the_neuron_responses" class="cell-output cell-output-display">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewbox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewbox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class="xr-text-repr-fallback">&lt;xarray.DataArray 'neuron responses' (stimulus: 1000, neuron: 2)&gt;
12.97 -15.39 1.005 3.224 1.226 2.431 ... 6.028 -6.32 5.488 -16.32 6.215 -9.989
Coordinates: (3/8)
  * neuron      (neuron) int64 1 2
  * stimulus    (stimulus) int64 1 2 3 4 5 6 7 ... 994 995 996 997 998 999 1000
    ...          ...
    std         (neuron) float64 1.0 3.0</pre><div class="xr-wrap" style="display:none"><div class="xr-header"><div class="xr-obj-type">xarray.DataArray</div><div class="xr-array-name">'neuron responses'</div><ul class="xr-dim-list"><li><span class="xr-has-index">stimulus</span>: 1000</li><li><span class="xr-has-index">neuron</span>: 2</li></ul></div><ul class="xr-sections"><li class="xr-section-item"><div class="xr-array-wrap"><input id="section-f0b079e1-b659-4f3c-9254-8e81f2d30c52" class="xr-array-in" type="checkbox"><label for="section-f0b079e1-b659-4f3c-9254-8e81f2d30c52" title="Show/hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-array-preview xr-preview"><span>12.97 -15.39 1.005 3.224 1.226 ... -6.32 5.488 -16.32 6.215 -9.989</span></div><div class="xr-array-data"><pre>array([[ 12.96533678, -15.38921968],
       [  1.00523852,   3.22448895],
       [  1.2258057 ,   2.43055775],
       ...,
       [  6.02810356,  -6.32031526],
       [  5.48782478, -16.32351293],
       [  6.21490603,  -9.98853112]])</pre></div></div></li><li class="xr-section-item"><input id="section-c6fca334-d454-4abc-8b05-f33a679a236c" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-c6fca334-d454-4abc-8b05-f33a679a236c" class="xr-section-summary">Coordinates: <span>(8)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">neuron</span></div><div class="xr-var-dims">(neuron)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">1 2</div><input id="attrs-0fa33897-69b3-435d-9f47-8f49bad277a6" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-0fa33897-69b3-435d-9f47-8f49bad277a6" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-d16c4717-7a20-43f8-b5c9-021b9675a139" class="xr-var-data-in" type="checkbox"><label for="data-d16c4717-7a20-43f8-b5c9-021b9675a139" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([1, 2])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">stimulus</span></div><div class="xr-var-dims">(stimulus)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">1 2 3 4 5 ... 996 997 998 999 1000</div><input id="attrs-4ad94154-3e8f-47f9-91bf-a1a1fcca349b" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-4ad94154-3e8f-47f9-91bf-a1a1fcca349b" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-5ce6f023-80de-4257-9da3-422fc2f77e52" class="xr-var-data-in" type="checkbox"><label for="data-5ce6f023-80de-4257-9da3-422fc2f77e52" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([   1,    2,    3, ...,  998,  999, 1000])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>color</span></div><div class="xr-var-dims">(stimulus)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">0.637 0.2698 ... 0.1649 0.38</div><input id="attrs-b8408bc2-a44e-4baf-ab47-29442af35983" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-b8408bc2-a44e-4baf-ab47-29442af35983" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-dcd5795a-531a-4281-b4c5-61a204cee08d" class="xr-var-data-in" type="checkbox"><label for="data-dcd5795a-531a-4281-b4c5-61a204cee08d" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([6.36961687e-01, 2.69786714e-01, 4.09735239e-02, 1.65276355e-02,
       8.13270239e-01, 9.12755577e-01, 6.06635776e-01, 7.29496561e-01,
       5.43624991e-01, 9.35072424e-01, 8.15853554e-01, 2.73850017e-03,
       8.57404277e-01, 3.35855753e-02, 7.29655446e-01, 1.75655621e-01,
       8.63178922e-01, 5.41461220e-01, 2.99711891e-01, 4.22687221e-01,
       2.83196711e-02, 1.24283276e-01, 6.70624415e-01, 6.47189512e-01,
       6.15385111e-01, 3.83677554e-01, 9.97209936e-01, 9.80835339e-01,
       6.85541984e-01, 6.50459276e-01, 6.88446731e-01, 3.88921424e-01,
       1.35096505e-01, 7.21488340e-01, 5.25354322e-01, 3.10241876e-01,
       4.85835359e-01, 8.89487834e-01, 9.34043516e-01, 3.57795197e-01,
       5.71529831e-01, 3.21869391e-01, 5.94300030e-01, 3.37911226e-01,
       3.91619001e-01, 8.90274352e-01, 2.27157594e-01, 6.23187145e-01,
       8.40153436e-02, 8.32644148e-01, 7.87098307e-01, 2.39369443e-01,
       8.76484231e-01, 5.85680348e-02, 3.36117061e-01, 1.50279467e-01,
       4.50339367e-01, 7.96324270e-01, 2.30642209e-01, 5.20213011e-02,
       4.04551840e-01, 1.98513045e-01, 9.07530456e-02, 5.80332386e-01,
       2.98696133e-01, 6.71994878e-01, 1.99515444e-01, 9.42113111e-01,
       3.65110168e-01, 1.05495280e-01, 6.29108152e-01, 9.27154553e-01,
       4.40377155e-01, 9.54590494e-01, 4.99895814e-01, 4.25228625e-01,
       6.20213452e-01, 9.95096505e-01, 9.48943675e-01, 4.60045139e-01,
...
       3.39811155e-01, 2.21699710e-04, 4.82537622e-01, 6.08000665e-01,
       9.29904601e-02, 2.42094402e-01, 8.03991821e-01, 8.40281560e-01,
       3.87733254e-01, 8.14223731e-01, 2.77140253e-01, 7.06108222e-01,
       5.45456624e-01, 4.40099079e-01, 6.56442276e-01, 1.33906791e-02,
       1.62443443e-01, 2.93823464e-01, 6.80562610e-01, 7.06235313e-01,
       6.80760824e-01, 7.67617107e-01, 7.95515610e-02, 1.05888908e-01,
       8.55351160e-01, 3.56837753e-01, 5.68371290e-01, 5.03502806e-01,
       6.26662571e-01, 7.69467112e-02, 7.69790226e-01, 1.23402328e-01,
       6.81374462e-01, 4.02142099e-01, 4.92261636e-01, 6.71693734e-01,
       3.71002751e-01, 4.60374714e-02, 9.64211552e-01, 5.22676899e-01,
       7.42144641e-01, 5.31294834e-01, 8.19686903e-01, 5.64616179e-01,
       1.22756878e-01, 6.41906565e-01, 1.72740669e-01, 8.23654135e-01,
       6.81061600e-01, 9.39808638e-01, 6.29080790e-01, 2.25163097e-01,
       5.57137546e-01, 7.71772277e-01, 7.11888298e-01, 3.42296706e-01,
       6.55351151e-01, 9.35269061e-01, 6.84810043e-01, 3.67301402e-01,
       9.10758330e-01, 8.27624193e-01, 8.55183760e-01, 1.06841377e-01,
       2.90828834e-01, 7.90127803e-01, 2.74807496e-01, 7.37059356e-02,
       6.83266012e-01, 7.99269956e-01, 6.41767808e-01, 3.44843336e-01,
       5.59773319e-01, 2.15199514e-02, 5.62661656e-01, 8.56801175e-01,
       7.80532350e-02, 3.83319397e-01, 1.64863718e-01, 3.80007897e-01])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>size</span></div><div class="xr-var-dims">(stimulus)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">0.01301 0.8278 ... 0.08158 0.3216</div><input id="attrs-2cf97361-a4ab-4daa-a2b0-f03b29dbf37f" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-2cf97361-a4ab-4daa-a2b0-f03b29dbf37f" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-0908ec40-b941-4bd2-a4dd-8a5e28ad826c" class="xr-var-data-in" type="checkbox"><label for="data-0908ec40-b941-4bd2-a4dd-8a5e28ad826c" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([0.01300767, 0.82776292, 0.49624331, 0.43591807, 0.60179472,
       0.8500282 , 0.29126072, 0.26751697, 0.04949421, 0.26639909,
       0.06621185, 0.04155849, 0.55273056, 0.18383489, 0.07425772,
       0.91671474, 0.14873389, 0.09483079, 0.97067806, 0.66696696,
       0.72575404, 0.563204  , 0.07038971, 0.84187724, 0.418029  ,
       0.39246782, 0.13530924, 0.11321989, 0.52224593, 0.56874359,
       0.51868554, 0.61312468, 0.87764346, 0.50420484, 0.37914768,
       0.2565727 , 0.30684664, 0.56080705, 0.79537234, 0.44112103,
       0.04076233, 0.1881545 , 0.09065223, 0.33334341, 0.68437666,
       0.59071473, 0.66212759, 0.45459513, 0.10978054, 0.29625596,
       0.51096048, 0.49716497, 0.24366139, 0.82530156, 0.43331334,
       0.84545613, 0.26549263, 0.94193959, 0.11185735, 0.76918249,
       0.02018645, 0.23632066, 0.8705533 , 0.350105  , 0.93247949,
       0.929417  , 0.80019258, 0.39610545, 0.8582685 , 0.45710434,
       0.1261722 , 0.85195837, 0.8162467 , 0.13556544, 0.86652652,
       0.51896305, 0.74359076, 0.26817602, 0.21546148, 0.84831281,
       0.6002138 , 0.14770547, 0.36587009, 0.85903582, 0.46828358,
       0.3368529 , 0.34095386, 0.8246442 , 0.45429903, 0.9483535 ,
       0.31220015, 0.75648033, 0.28570549, 0.7678388 , 0.01759798,
       0.12982098, 0.25925691, 0.87009196, 0.32249838, 0.48352554,
...
       0.25857775, 0.09677339, 0.18039325, 0.25448073, 0.83934999,
       0.22122572, 0.82839782, 0.74329961, 0.97429452, 0.75359014,
       0.11511305, 0.94004275, 0.84209462, 0.4436286 , 0.43358894,
       0.03095428, 0.21764154, 0.71488612, 0.1105268 , 0.99174489,
       0.02168247, 0.99097346, 0.29620757, 0.46086521, 0.54547145,
       0.28955319, 0.22049757, 0.0505692 , 0.823433  , 0.97230937,
       0.12555748, 0.85983084, 0.72053945, 0.75022534, 0.38780546,
       0.05757491, 0.69042312, 0.96212643, 0.65875825, 0.23405231,
       0.53673526, 0.12167514, 0.71787855, 0.67286419, 0.446794  ,
       0.00866449, 0.06036607, 0.68197769, 0.69241334, 0.57520933,
       0.22769122, 0.66313159, 0.1055052 , 0.62768057, 0.57231791,
       0.35549364, 0.21916604, 0.7245827 , 0.18099196, 0.15735466,
       0.63276412, 0.66062453, 0.1019691 , 0.26228831, 0.09859603,
       0.91383146, 0.00838652, 0.35101158, 0.15682101, 0.46699488,
       0.90683736, 0.70737638, 0.36017375, 0.1866537 , 0.70501213,
       0.54191587, 0.72028997, 0.04485529, 0.17314062, 0.3198733 ,
       0.4665367 , 0.56944602, 0.56209399, 0.54291566, 0.56611634,
       0.41747562, 0.27881285, 0.51812954, 0.12186051, 0.74927137,
       0.95293572, 0.05409649, 0.78232714, 0.22383289, 0.33641135,
       0.03353818, 0.9690858 , 0.56209561, 0.08158143, 0.32155563])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>beta_color</span></div><div class="xr-var-dims">(neuron)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">3.0 -2.0</div><input id="attrs-9b0f1b0c-89ac-40ad-b48f-f95fcad3546c" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-9b0f1b0c-89ac-40ad-b48f-f95fcad3546c" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-9a977c20-8049-4737-91ec-e55e550aa26a" class="xr-var-data-in" type="checkbox"><label for="data-9a977c20-8049-4737-91ec-e55e550aa26a" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([ 3., -2.])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>beta_size</span></div><div class="xr-var-dims">(neuron)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">-2.0 5.0</div><input id="attrs-5891a783-7145-4f0b-8190-139a9c608fa7" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-5891a783-7145-4f0b-8190-139a9c608fa7" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-7e676bd7-3e37-42e2-9982-789c9851d921" class="xr-var-data-in" type="checkbox"><label for="data-7e676bd7-3e37-42e2-9982-789c9851d921" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([-2.,  5.])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>mean</span></div><div class="xr-var-dims">(neuron)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">7.0 -6.0</div><input id="attrs-58080c34-9f8c-4ee2-a604-12a86dcfd7e7" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-58080c34-9f8c-4ee2-a604-12a86dcfd7e7" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-6e8198a6-a57a-497f-8d30-229670afe814" class="xr-var-data-in" type="checkbox"><label for="data-6e8198a6-a57a-497f-8d30-229670afe814" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([ 7., -6.])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>std</span></div><div class="xr-var-dims">(neuron)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">1.0 3.0</div><input id="attrs-669c872b-9c04-447f-b539-c1b0cbfcd1f0" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-669c872b-9c04-447f-b539-c1b0cbfcd1f0" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-86ca559d-4a80-4d5b-a0e2-71d3b1e1eb09" class="xr-var-data-in" type="checkbox"><label for="data-86ca559d-4a80-4d5b-a0e2-71d3b1e1eb09" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([1., 3.])</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-7d96a311-3b0c-4b68-a76f-6b7f3c98d71c" class="xr-section-summary-in" type="checkbox"><label for="section-7d96a311-3b0c-4b68-a76f-6b7f3c98d71c" class="xr-section-summary">Indexes: <span>(2)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-index-name"><div>neuron</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-2512d730-11b8-47fe-ac82-4ff67b6a099d" class="xr-index-data-in" type="checkbox"><label for="index-2512d730-11b8-47fe-ac82-4ff67b6a099d" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([1, 2], dtype='int64', name='neuron'))</pre></div></li><li class="xr-var-item"><div class="xr-index-name"><div>stimulus</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-b494dd0c-7081-4000-992a-79c3b38ac234" class="xr-index-data-in" type="checkbox"><label for="index-b494dd0c-7081-4000-992a-79c3b38ac234" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([   1,    2,    3,    4,    5,    6,    7,    8,    9,   10,
       ...
        991,  992,  993,  994,  995,  996,  997,  998,  999, 1000],
      dtype='int64', name='stimulus', length=1000))</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-e0607b8f-95e8-44d1-9918-218d4c18dac9" class="xr-section-summary-in" type="checkbox" disabled=""><label for="section-e0607b8f-95e8-44d1-9918-218d4c18dac9" class="xr-section-summary" title="Expand/collapse section">Attributes: <span>(0)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><dl class="xr-attrs"></dl></div></li></ul></div></div>
</div>
</div>
</section>
</section>
<section id="understanding-the-neural-code" class="level2">
<h2 class="anchored" data-anchor-id="understanding-the-neural-code">Understanding the neural code</h2>
<p>How is this information encoded in the population activity? Is there a neuron that is sensitive to color and another that is sensitive to size?</p>
<p>One way to understand this is by studying the neurons directly. Let’s start by visualizing the response of each neuron to our stimuli. Note that the below plots are 1-dimensional scatterplots; the spread along the vertical axis is just for visualization purposes.</p>
<div id="4444cb07" class="cell" data-add-from="../src/utilities/toy_example.py" data-code-filename="(Function) Visualize individual scatter" data-end-line="129" data-source-lang="python" data-start-line="88" data-execution_count="13">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="4444cb07" data-startfrom="88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python" style="counter-reset: source-line 87;"><span id="4444cb07-88"><a href="#4444cb07-88" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> view_individual_scatter(</span>
<span id="4444cb07-89"><a href="#4444cb07-89" aria-hidden="true" tabindex="-1"></a>    data: xr.DataArray,</span>
<span id="4444cb07-90"><a href="#4444cb07-90" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>,</span>
<span id="4444cb07-91"><a href="#4444cb07-91" aria-hidden="true" tabindex="-1"></a>    coord: <span class="bu">str</span>,</span>
<span id="4444cb07-92"><a href="#4444cb07-92" aria-hidden="true" tabindex="-1"></a>    dim: <span class="bu">str</span>,</span>
<span id="4444cb07-93"><a href="#4444cb07-93" aria-hidden="true" tabindex="-1"></a>    template_func: Callable[[<span class="bu">int</span>], <span class="bu">str</span>],</span>
<span id="4444cb07-94"><a href="#4444cb07-94" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> Figure:</span>
<span id="4444cb07-95"><a href="#4444cb07-95" aria-hidden="true" tabindex="-1"></a>    rng <span class="op">=</span> np.random.default_rng()</span>
<span id="4444cb07-96"><a href="#4444cb07-96" aria-hidden="true" tabindex="-1"></a>    data_ <span class="op">=</span> data.assign_coords(</span>
<span id="4444cb07-97"><a href="#4444cb07-97" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"arbitrary"</span>: (<span class="st">"stimulus"</span>, rng.random(data.sizes[<span class="st">"stimulus"</span>]))}</span>
<span id="4444cb07-98"><a href="#4444cb07-98" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="4444cb07-99"><a href="#4444cb07-99" aria-hidden="true" tabindex="-1"></a>    min_, max_ <span class="op">=</span> data_.<span class="bu">min</span>(), data_.<span class="bu">max</span>()</span>
<span id="4444cb07-100"><a href="#4444cb07-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="4444cb07-101"><a href="#4444cb07-101" aria-hidden="true" tabindex="-1"></a>    n_features <span class="op">=</span> data.sizes[dim]</span>
<span id="4444cb07-102"><a href="#4444cb07-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="4444cb07-103"><a href="#4444cb07-103" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span>n_features, figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">2</span> <span class="op">*</span> n_features))</span>
<span id="4444cb07-104"><a href="#4444cb07-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="4444cb07-105"><a href="#4444cb07-105" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> index, ax <span class="kw">in</span> <span class="bu">zip</span>(data[coord].values, axes.flat):</span>
<span id="4444cb07-106"><a href="#4444cb07-106" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> template_func(index)</span>
<span id="4444cb07-107"><a href="#4444cb07-107" aria-hidden="true" tabindex="-1"></a>        sns.scatterplot(</span>
<span id="4444cb07-108"><a href="#4444cb07-108" aria-hidden="true" tabindex="-1"></a>            ax<span class="op">=</span>ax,</span>
<span id="4444cb07-109"><a href="#4444cb07-109" aria-hidden="true" tabindex="-1"></a>            data<span class="op">=</span>(</span>
<span id="4444cb07-110"><a href="#4444cb07-110" aria-hidden="true" tabindex="-1"></a>                data_.isel({dim: data[coord].values <span class="op">==</span> index})</span>
<span id="4444cb07-111"><a href="#4444cb07-111" aria-hidden="true" tabindex="-1"></a>                .rename(label)</span>
<span id="4444cb07-112"><a href="#4444cb07-112" aria-hidden="true" tabindex="-1"></a>                .to_dataframe()</span>
<span id="4444cb07-113"><a href="#4444cb07-113" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="4444cb07-114"><a href="#4444cb07-114" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span>label,</span>
<span id="4444cb07-115"><a href="#4444cb07-115" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span><span class="st">"arbitrary"</span>,</span>
<span id="4444cb07-116"><a href="#4444cb07-116" aria-hidden="true" tabindex="-1"></a>            hue<span class="op">=</span><span class="st">"color"</span>,</span>
<span id="4444cb07-117"><a href="#4444cb07-117" aria-hidden="true" tabindex="-1"></a>            size<span class="op">=</span><span class="st">"size"</span>,</span>
<span id="4444cb07-118"><a href="#4444cb07-118" aria-hidden="true" tabindex="-1"></a>            palette<span class="op">=</span><span class="st">"flare"</span>,</span>
<span id="4444cb07-119"><a href="#4444cb07-119" aria-hidden="true" tabindex="-1"></a>            legend<span class="op">=</span><span class="va">False</span>,</span>
<span id="4444cb07-120"><a href="#4444cb07-120" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="4444cb07-121"><a href="#4444cb07-121" aria-hidden="true" tabindex="-1"></a>        sns.despine(ax<span class="op">=</span>ax, left<span class="op">=</span><span class="va">True</span>, offset<span class="op">=</span><span class="dv">10</span>)</span>
<span id="4444cb07-122"><a href="#4444cb07-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="4444cb07-123"><a href="#4444cb07-123" aria-hidden="true" tabindex="-1"></a>        ax.set_xlim([min_, max_])</span>
<span id="4444cb07-124"><a href="#4444cb07-124" aria-hidden="true" tabindex="-1"></a>        ax.get_yaxis().set_visible(<span class="va">False</span>)</span>
<span id="4444cb07-125"><a href="#4444cb07-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="4444cb07-126"><a href="#4444cb07-126" aria-hidden="true" tabindex="-1"></a>    fig.tight_layout(h_pad<span class="op">=</span><span class="dv">3</span>)</span>
<span id="4444cb07-127"><a href="#4444cb07-127" aria-hidden="true" tabindex="-1"></a>    plt.close(fig)</span>
<span id="4444cb07-128"><a href="#4444cb07-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="4444cb07-129"><a href="#4444cb07-129" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-visualize_neuron_responses" class="cell" data-execution_count="14">
<details>
<summary>Visualize the individual neuron responses</summary>
<div class="sourceCode cell-code" id="cell-visualize_neuron_responses"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cell-visualize_neuron_responses-1"><a href="#cell-visualize_neuron_responses-1" aria-hidden="true" tabindex="-1"></a>view_individual_scatter(</span>
<span id="cell-visualize_neuron_responses-2"><a href="#cell-visualize_neuron_responses-2" aria-hidden="true" tabindex="-1"></a>    data,</span>
<span id="cell-visualize_neuron_responses-3"><a href="#cell-visualize_neuron_responses-3" aria-hidden="true" tabindex="-1"></a>    coord<span class="op">=</span><span class="st">"neuron"</span>,</span>
<span id="cell-visualize_neuron_responses-4"><a href="#cell-visualize_neuron_responses-4" aria-hidden="true" tabindex="-1"></a>    dim<span class="op">=</span><span class="st">"neuron"</span>,</span>
<span id="cell-visualize_neuron_responses-5"><a href="#cell-visualize_neuron_responses-5" aria-hidden="true" tabindex="-1"></a>    template_func<span class="op">=</span><span class="kw">lambda</span> x: <span class="ss">f"neuron </span><span class="sc">{</span>x<span class="sc">}</span><span class="ss"> response"</span>,</span>
<span id="cell-visualize_neuron_responses-6"><a href="#cell-visualize_neuron_responses-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="12">
<div id="visualize_neuron_responses" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="introducing_pca_files/figure-html/visualize_neuron_responses-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>By visualizing the responses, we can see that each neuron is tuned to both color <em>and</em> size.</p>
<p>We can also use methods such as Representational Similarity Analysis (RSA)<span class="citation" data-cites="Kriegeskorte2008">(<a href="#ref-Kriegeskorte2008" role="doc-biblioref">Kriegeskorte 2008</a>)</span> to study the information content of the two neurons. In RSA, the dissimilarity between the response of a system to each pair of stimuli is obtained and represented in a matrix of dissimilarities (a <em>representational dissimilarity matrix</em>, or RDM). Therefore, an RDM indicates the degree to which each pair of stimuli is distinguished by a system.</p>
<p><img src="../resources/rsa.png" class="img-fluid"></p>
<p>What if we want to study the underlying structure of this code? Is there another view of the population code that might be more informative?</p>
</section>
<section id="studying-the-latent-dimensions" class="level2">
<h2 class="anchored" data-anchor-id="studying-the-latent-dimensions">Studying the latent dimensions</h2>
<p>Instead of directly studying the neurons, we can focus on the underlying factors that capture the structure and variance in the data.</p>
<section id="some-geometric-intuition" class="level3">
<h3 class="anchored" data-anchor-id="some-geometric-intuition">Some geometric intuition</h3>
<p>Since we only have <span class="math inline">P = 2</span> neurons, we can visualize these data as a scatterplot, which makes their <a href="../pages/reference.html#covariance">covariance</a> apparent.</p>
<div id="cell-view_joint_scatter" class="cell" data-execution_count="15">
<details>
<summary>visualize the joint response</summary>
<div class="sourceCode cell-code" id="cell-view_joint_scatter"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cell-view_joint_scatter-1"><a href="#cell-view_joint_scatter-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> view_joint_scatter(</span>
<span id="cell-view_joint_scatter-2"><a href="#cell-view_joint_scatter-2" aria-hidden="true" tabindex="-1"></a>    data: xr.DataArray,</span>
<span id="cell-view_joint_scatter-3"><a href="#cell-view_joint_scatter-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>,</span>
<span id="cell-view_joint_scatter-4"><a href="#cell-view_joint_scatter-4" aria-hidden="true" tabindex="-1"></a>    coord: <span class="bu">str</span>,</span>
<span id="cell-view_joint_scatter-5"><a href="#cell-view_joint_scatter-5" aria-hidden="true" tabindex="-1"></a>    dim: <span class="bu">str</span>,</span>
<span id="cell-view_joint_scatter-6"><a href="#cell-view_joint_scatter-6" aria-hidden="true" tabindex="-1"></a>    template_func: Callable[[<span class="bu">int</span>], <span class="bu">str</span>],</span>
<span id="cell-view_joint_scatter-7"><a href="#cell-view_joint_scatter-7" aria-hidden="true" tabindex="-1"></a>    draw_axes: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cell-view_joint_scatter-8"><a href="#cell-view_joint_scatter-8" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> Figure:</span>
<span id="cell-view_joint_scatter-9"><a href="#cell-view_joint_scatter-9" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cell-view_joint_scatter-10"><a href="#cell-view_joint_scatter-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cell-view_joint_scatter-11"><a href="#cell-view_joint_scatter-11" aria-hidden="true" tabindex="-1"></a>    data_ <span class="op">=</span> pd.DataFrame(</span>
<span id="cell-view_joint_scatter-12"><a href="#cell-view_joint_scatter-12" aria-hidden="true" tabindex="-1"></a>        {coord_: data[coord_].values <span class="cf">for</span> coord_ <span class="kw">in</span> (<span class="st">"color"</span>, <span class="st">"size"</span>)}</span>
<span id="cell-view_joint_scatter-13"><a href="#cell-view_joint_scatter-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span> {</span>
<span id="cell-view_joint_scatter-14"><a href="#cell-view_joint_scatter-14" aria-hidden="true" tabindex="-1"></a>            template_func(index): data.isel({dim: index <span class="op">-</span> <span class="dv">1</span>}).to_dataframe()[coord]</span>
<span id="cell-view_joint_scatter-15"><a href="#cell-view_joint_scatter-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> index <span class="kw">in</span> (<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cell-view_joint_scatter-16"><a href="#cell-view_joint_scatter-16" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cell-view_joint_scatter-17"><a href="#cell-view_joint_scatter-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cell-view_joint_scatter-18"><a href="#cell-view_joint_scatter-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cell-view_joint_scatter-19"><a href="#cell-view_joint_scatter-19" aria-hidden="true" tabindex="-1"></a>    sns.scatterplot(</span>
<span id="cell-view_joint_scatter-20"><a href="#cell-view_joint_scatter-20" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>ax,</span>
<span id="cell-view_joint_scatter-21"><a href="#cell-view_joint_scatter-21" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>data_,</span>
<span id="cell-view_joint_scatter-22"><a href="#cell-view_joint_scatter-22" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>template_func(<span class="dv">1</span>),</span>
<span id="cell-view_joint_scatter-23"><a href="#cell-view_joint_scatter-23" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>template_func(<span class="dv">2</span>),</span>
<span id="cell-view_joint_scatter-24"><a href="#cell-view_joint_scatter-24" aria-hidden="true" tabindex="-1"></a>        hue<span class="op">=</span><span class="st">"color"</span>,</span>
<span id="cell-view_joint_scatter-25"><a href="#cell-view_joint_scatter-25" aria-hidden="true" tabindex="-1"></a>        size<span class="op">=</span><span class="st">"size"</span>,</span>
<span id="cell-view_joint_scatter-26"><a href="#cell-view_joint_scatter-26" aria-hidden="true" tabindex="-1"></a>        legend<span class="op">=</span><span class="va">False</span>,</span>
<span id="cell-view_joint_scatter-27"><a href="#cell-view_joint_scatter-27" aria-hidden="true" tabindex="-1"></a>        palette<span class="op">=</span><span class="st">"flare"</span>,</span>
<span id="cell-view_joint_scatter-28"><a href="#cell-view_joint_scatter-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cell-view_joint_scatter-29"><a href="#cell-view_joint_scatter-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> draw_axes:</span>
<span id="cell-view_joint_scatter-30"><a href="#cell-view_joint_scatter-30" aria-hidden="true" tabindex="-1"></a>        ax.axhline(<span class="dv">0</span>, c<span class="op">=</span><span class="st">"gray"</span>, ls<span class="op">=</span><span class="st">"--"</span>)</span>
<span id="cell-view_joint_scatter-31"><a href="#cell-view_joint_scatter-31" aria-hidden="true" tabindex="-1"></a>        ax.axvline(<span class="dv">0</span>, c<span class="op">=</span><span class="st">"gray"</span>, ls<span class="op">=</span><span class="st">"--"</span>)</span>
<span id="cell-view_joint_scatter-32"><a href="#cell-view_joint_scatter-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cell-view_joint_scatter-33"><a href="#cell-view_joint_scatter-33" aria-hidden="true" tabindex="-1"></a>    ax.set_aspect(<span class="st">"equal"</span>, <span class="st">"box"</span>)</span>
<span id="cell-view_joint_scatter-34"><a href="#cell-view_joint_scatter-34" aria-hidden="true" tabindex="-1"></a>    sns.despine(ax<span class="op">=</span>ax, offset<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cell-view_joint_scatter-35"><a href="#cell-view_joint_scatter-35" aria-hidden="true" tabindex="-1"></a>    plt.close(fig)</span>
<span id="cell-view_joint_scatter-36"><a href="#cell-view_joint_scatter-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cell-view_joint_scatter-37"><a href="#cell-view_joint_scatter-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cell-view_joint_scatter-38"><a href="#cell-view_joint_scatter-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cell-view_joint_scatter-39"><a href="#cell-view_joint_scatter-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cell-view_joint_scatter-40"><a href="#cell-view_joint_scatter-40" aria-hidden="true" tabindex="-1"></a>view_joint_scatter(</span>
<span id="cell-view_joint_scatter-41"><a href="#cell-view_joint_scatter-41" aria-hidden="true" tabindex="-1"></a>    data,</span>
<span id="cell-view_joint_scatter-42"><a href="#cell-view_joint_scatter-42" aria-hidden="true" tabindex="-1"></a>    coord<span class="op">=</span><span class="st">"neuron responses"</span>,</span>
<span id="cell-view_joint_scatter-43"><a href="#cell-view_joint_scatter-43" aria-hidden="true" tabindex="-1"></a>    dim<span class="op">=</span><span class="st">"neuron"</span>,</span>
<span id="cell-view_joint_scatter-44"><a href="#cell-view_joint_scatter-44" aria-hidden="true" tabindex="-1"></a>    template_func<span class="op">=</span><span class="kw">lambda</span> x: <span class="ss">f"neuron </span><span class="sc">{</span>x<span class="sc">}</span><span class="ss"> response"</span>,</span>
<span id="cell-view_joint_scatter-45"><a href="#cell-view_joint_scatter-45" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="13">
<div id="view_joint_scatter" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="introducing_pca_files/figure-html/view_joint_scatter-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can use the covariance to change the way we view the data. Run the animation below for demonstration.</p>
<div id="visualize_pca_animation" class="cell" data-execution_count="16">
<details>
<summary>Animate the PCA transformation</summary>
<div class="sourceCode cell-code" id="visualize_pca_animation"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="visualize_pca_animation-1"><a href="#visualize_pca_animation-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> animate_pca_transformation(</span>
<span id="visualize_pca_animation-2"><a href="#visualize_pca_animation-2" aria-hidden="true" tabindex="-1"></a>    data: xr.DataArray,</span>
<span id="visualize_pca_animation-3"><a href="#visualize_pca_animation-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>,</span>
<span id="visualize_pca_animation-4"><a href="#visualize_pca_animation-4" aria-hidden="true" tabindex="-1"></a>    durations: <span class="bu">dict</span>[<span class="bu">str</span>, <span class="bu">int</span>] <span class="op">=</span> {</span>
<span id="visualize_pca_animation-5"><a href="#visualize_pca_animation-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"center"</span>: <span class="dv">1_000</span>,</span>
<span id="visualize_pca_animation-6"><a href="#visualize_pca_animation-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"rotate"</span>: <span class="dv">1_000</span>,</span>
<span id="visualize_pca_animation-7"><a href="#visualize_pca_animation-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"pause"</span>: <span class="dv">500</span>,</span>
<span id="visualize_pca_animation-8"><a href="#visualize_pca_animation-8" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="visualize_pca_animation-9"><a href="#visualize_pca_animation-9" aria-hidden="true" tabindex="-1"></a>    interval: <span class="bu">int</span> <span class="op">=</span> <span class="dv">50</span>,</span>
<span id="visualize_pca_animation-10"><a href="#visualize_pca_animation-10" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="visualize_pca_animation-11"><a href="#visualize_pca_animation-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _compute_2d_rotation_matrix(theta: <span class="bu">float</span>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="visualize_pca_animation-12"><a href="#visualize_pca_animation-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.array(</span>
<span id="visualize_pca_animation-13"><a href="#visualize_pca_animation-13" aria-hidden="true" tabindex="-1"></a>            [</span>
<span id="visualize_pca_animation-14"><a href="#visualize_pca_animation-14" aria-hidden="true" tabindex="-1"></a>                [np.cos(theta), <span class="op">-</span>np.sin(theta)],</span>
<span id="visualize_pca_animation-15"><a href="#visualize_pca_animation-15" aria-hidden="true" tabindex="-1"></a>                [np.sin(theta), np.cos(theta)],</span>
<span id="visualize_pca_animation-16"><a href="#visualize_pca_animation-16" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="visualize_pca_animation-17"><a href="#visualize_pca_animation-17" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="visualize_pca_animation-18"><a href="#visualize_pca_animation-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="visualize_pca_animation-19"><a href="#visualize_pca_animation-19" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> view_joint_scatter(</span>
<span id="visualize_pca_animation-20"><a href="#visualize_pca_animation-20" aria-hidden="true" tabindex="-1"></a>        data,</span>
<span id="visualize_pca_animation-21"><a href="#visualize_pca_animation-21" aria-hidden="true" tabindex="-1"></a>        coord<span class="op">=</span><span class="st">"neuron responses"</span>,</span>
<span id="visualize_pca_animation-22"><a href="#visualize_pca_animation-22" aria-hidden="true" tabindex="-1"></a>        dim<span class="op">=</span><span class="st">"neuron"</span>,</span>
<span id="visualize_pca_animation-23"><a href="#visualize_pca_animation-23" aria-hidden="true" tabindex="-1"></a>        template_func<span class="op">=</span><span class="kw">lambda</span> x: <span class="ss">f"neuron </span><span class="sc">{</span>x<span class="sc">}</span><span class="ss"> response"</span>,</span>
<span id="visualize_pca_animation-24"><a href="#visualize_pca_animation-24" aria-hidden="true" tabindex="-1"></a>        draw_axes<span class="op">=</span><span class="va">True</span>,</span>
<span id="visualize_pca_animation-25"><a href="#visualize_pca_animation-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="visualize_pca_animation-26"><a href="#visualize_pca_animation-26" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> fig.get_axes()[<span class="dv">0</span>]</span>
<span id="visualize_pca_animation-27"><a href="#visualize_pca_animation-27" aria-hidden="true" tabindex="-1"></a>    scatter <span class="op">=</span> ax.get_children()[<span class="dv">0</span>]</span>
<span id="visualize_pca_animation-28"><a href="#visualize_pca_animation-28" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span> fig.suptitle(<span class="st">"neuron responses"</span>)</span>
<span id="visualize_pca_animation-29"><a href="#visualize_pca_animation-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="visualize_pca_animation-30"><a href="#visualize_pca_animation-30" aria-hidden="true" tabindex="-1"></a>    n_frames <span class="op">=</span> {key: value <span class="op">//</span> interval <span class="op">+</span> <span class="dv">1</span> <span class="cf">for</span> key, value <span class="kw">in</span> durations.items()}</span>
<span id="visualize_pca_animation-31"><a href="#visualize_pca_animation-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="visualize_pca_animation-32"><a href="#visualize_pca_animation-32" aria-hidden="true" tabindex="-1"></a>    x_mean, y_mean <span class="op">=</span> data.mean(<span class="st">"stimulus"</span>).values</span>
<span id="visualize_pca_animation-33"><a href="#visualize_pca_animation-33" aria-hidden="true" tabindex="-1"></a>    delta <span class="op">=</span> np.array([x_mean, y_mean]) <span class="op">/</span> n_frames[<span class="st">"center"</span>]</span>
<span id="visualize_pca_animation-34"><a href="#visualize_pca_animation-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="visualize_pca_animation-35"><a href="#visualize_pca_animation-35" aria-hidden="true" tabindex="-1"></a>    _, _, v_h <span class="op">=</span> np.linalg.svd(data <span class="op">-</span> data.mean(<span class="st">"stimulus"</span>))</span>
<span id="visualize_pca_animation-36"><a href="#visualize_pca_animation-36" aria-hidden="true" tabindex="-1"></a>    v <span class="op">=</span> v_h.transpose()</span>
<span id="visualize_pca_animation-37"><a href="#visualize_pca_animation-37" aria-hidden="true" tabindex="-1"></a>    theta <span class="op">=</span> np.arccos(v[<span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="visualize_pca_animation-38"><a href="#visualize_pca_animation-38" aria-hidden="true" tabindex="-1"></a>    rotation <span class="op">=</span> _compute_2d_rotation_matrix(<span class="op">-</span>theta <span class="op">/</span> n_frames[<span class="st">"rotate"</span>])</span>
<span id="visualize_pca_animation-39"><a href="#visualize_pca_animation-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="visualize_pca_animation-40"><a href="#visualize_pca_animation-40" aria-hidden="true" tabindex="-1"></a>    transformed <span class="op">=</span> (data <span class="op">-</span> data.mean(<span class="st">"stimulus"</span>)).values <span class="op">@</span> v</span>
<span id="visualize_pca_animation-41"><a href="#visualize_pca_animation-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="visualize_pca_animation-42"><a href="#visualize_pca_animation-42" aria-hidden="true" tabindex="-1"></a>    radius <span class="op">=</span> <span class="bu">max</span>(np.linalg.norm(transformed, axis<span class="op">=-</span><span class="dv">1</span>))</span>
<span id="visualize_pca_animation-43"><a href="#visualize_pca_animation-43" aria-hidden="true" tabindex="-1"></a>    limit <span class="op">=</span> <span class="bu">max</span>(np.<span class="bu">abs</span>(data).<span class="bu">max</span>(), np.<span class="bu">abs</span>(transformed).<span class="bu">max</span>(), radius)</span>
<span id="visualize_pca_animation-44"><a href="#visualize_pca_animation-44" aria-hidden="true" tabindex="-1"></a>    ax.set_xlim([<span class="op">-</span>limit, limit])</span>
<span id="visualize_pca_animation-45"><a href="#visualize_pca_animation-45" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim([<span class="op">-</span>limit, limit])</span>
<span id="visualize_pca_animation-46"><a href="#visualize_pca_animation-46" aria-hidden="true" tabindex="-1"></a>    fig.tight_layout()</span>
<span id="visualize_pca_animation-47"><a href="#visualize_pca_animation-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="visualize_pca_animation-48"><a href="#visualize_pca_animation-48" aria-hidden="true" tabindex="-1"></a>    frame_to_retitle_center <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> n_frames[<span class="st">"pause"</span>]</span>
<span id="visualize_pca_animation-49"><a href="#visualize_pca_animation-49" aria-hidden="true" tabindex="-1"></a>    frame_to_start_centering <span class="op">=</span> frame_to_retitle_center <span class="op">+</span> n_frames[<span class="st">"pause"</span>]</span>
<span id="visualize_pca_animation-50"><a href="#visualize_pca_animation-50" aria-hidden="true" tabindex="-1"></a>    frame_to_stop_centering <span class="op">=</span> frame_to_start_centering <span class="op">+</span> n_frames[<span class="st">"center"</span>]</span>
<span id="visualize_pca_animation-51"><a href="#visualize_pca_animation-51" aria-hidden="true" tabindex="-1"></a>    frame_to_retitle_rotate <span class="op">=</span> frame_to_stop_centering <span class="op">+</span> n_frames[<span class="st">"pause"</span>]</span>
<span id="visualize_pca_animation-52"><a href="#visualize_pca_animation-52" aria-hidden="true" tabindex="-1"></a>    frame_to_start_rotating <span class="op">=</span> frame_to_retitle_rotate <span class="op">+</span> n_frames[<span class="st">"pause"</span>]</span>
<span id="visualize_pca_animation-53"><a href="#visualize_pca_animation-53" aria-hidden="true" tabindex="-1"></a>    frame_to_stop_rotating <span class="op">=</span> frame_to_start_rotating <span class="op">+</span> n_frames[<span class="st">"rotate"</span>]</span>
<span id="visualize_pca_animation-54"><a href="#visualize_pca_animation-54" aria-hidden="true" tabindex="-1"></a>    frame_to_retitle_transformed <span class="op">=</span> frame_to_stop_rotating <span class="op">+</span> n_frames[<span class="st">"pause"</span>]</span>
<span id="visualize_pca_animation-55"><a href="#visualize_pca_animation-55" aria-hidden="true" tabindex="-1"></a>    frame_to_end <span class="op">=</span> frame_to_retitle_transformed <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> n_frames[<span class="st">"pause"</span>]</span>
<span id="visualize_pca_animation-56"><a href="#visualize_pca_animation-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="visualize_pca_animation-57"><a href="#visualize_pca_animation-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _update(frame: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="visualize_pca_animation-58"><a href="#visualize_pca_animation-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> frame <span class="op">&lt;</span> frame_to_retitle_center:</span>
<span id="visualize_pca_animation-59"><a href="#visualize_pca_animation-59" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="visualize_pca_animation-60"><a href="#visualize_pca_animation-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> frame <span class="op">==</span> frame_to_retitle_center:</span>
<span id="visualize_pca_animation-61"><a href="#visualize_pca_animation-61" aria-hidden="true" tabindex="-1"></a>            title.set_text(<span class="st">"step 1 of 2: center the data"</span>)</span>
<span id="visualize_pca_animation-62"><a href="#visualize_pca_animation-62" aria-hidden="true" tabindex="-1"></a>            ax.set_xlabel(<span class="st">""</span>)</span>
<span id="visualize_pca_animation-63"><a href="#visualize_pca_animation-63" aria-hidden="true" tabindex="-1"></a>            ax.set_ylabel(<span class="st">""</span>)</span>
<span id="visualize_pca_animation-64"><a href="#visualize_pca_animation-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> frame <span class="op">&lt;</span> frame_to_start_centering:</span>
<span id="visualize_pca_animation-65"><a href="#visualize_pca_animation-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="visualize_pca_animation-66"><a href="#visualize_pca_animation-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> frame <span class="op">&lt;=</span> frame_to_stop_centering:</span>
<span id="visualize_pca_animation-67"><a href="#visualize_pca_animation-67" aria-hidden="true" tabindex="-1"></a>            scatter.set_offsets(scatter.get_offsets() <span class="op">-</span> delta)</span>
<span id="visualize_pca_animation-68"><a href="#visualize_pca_animation-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> frame <span class="op">==</span> frame_to_retitle_rotate:</span>
<span id="visualize_pca_animation-69"><a href="#visualize_pca_animation-69" aria-hidden="true" tabindex="-1"></a>            title.set_text(<span class="st">"step 2 of 2: rotate the data"</span>)</span>
<span id="visualize_pca_animation-70"><a href="#visualize_pca_animation-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> frame <span class="op">&lt;</span> frame_to_start_rotating:</span>
<span id="visualize_pca_animation-71"><a href="#visualize_pca_animation-71" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="visualize_pca_animation-72"><a href="#visualize_pca_animation-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> frame <span class="op">&lt;=</span> frame_to_stop_rotating:</span>
<span id="visualize_pca_animation-73"><a href="#visualize_pca_animation-73" aria-hidden="true" tabindex="-1"></a>            scatter.set_offsets(scatter.get_offsets().data <span class="op">@</span> rotation)</span>
<span id="visualize_pca_animation-74"><a href="#visualize_pca_animation-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> frame <span class="op">&lt;</span> frame_to_retitle_transformed:</span>
<span id="visualize_pca_animation-75"><a href="#visualize_pca_animation-75" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="visualize_pca_animation-76"><a href="#visualize_pca_animation-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> frame <span class="op">==</span> frame_to_retitle_transformed:</span>
<span id="visualize_pca_animation-77"><a href="#visualize_pca_animation-77" aria-hidden="true" tabindex="-1"></a>            title.set_text(<span class="st">"principal components"</span>)</span>
<span id="visualize_pca_animation-78"><a href="#visualize_pca_animation-78" aria-hidden="true" tabindex="-1"></a>            ax.set_xlabel(<span class="st">"principal component 1"</span>)</span>
<span id="visualize_pca_animation-79"><a href="#visualize_pca_animation-79" aria-hidden="true" tabindex="-1"></a>            ax.set_ylabel(<span class="st">"principal component 2"</span>)</span>
<span id="visualize_pca_animation-80"><a href="#visualize_pca_animation-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> frame <span class="op">&lt;=</span> frame_to_end:</span>
<span id="visualize_pca_animation-81"><a href="#visualize_pca_animation-81" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="visualize_pca_animation-82"><a href="#visualize_pca_animation-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="visualize_pca_animation-83"><a href="#visualize_pca_animation-83" aria-hidden="true" tabindex="-1"></a>    animation <span class="op">=</span> FuncAnimation(</span>
<span id="visualize_pca_animation-84"><a href="#visualize_pca_animation-84" aria-hidden="true" tabindex="-1"></a>        fig<span class="op">=</span>fig,</span>
<span id="visualize_pca_animation-85"><a href="#visualize_pca_animation-85" aria-hidden="true" tabindex="-1"></a>        func<span class="op">=</span>_update,</span>
<span id="visualize_pca_animation-86"><a href="#visualize_pca_animation-86" aria-hidden="true" tabindex="-1"></a>        frames<span class="op">=</span>frame_to_end,</span>
<span id="visualize_pca_animation-87"><a href="#visualize_pca_animation-87" aria-hidden="true" tabindex="-1"></a>        interval<span class="op">=</span>interval,</span>
<span id="visualize_pca_animation-88"><a href="#visualize_pca_animation-88" aria-hidden="true" tabindex="-1"></a>        repeat<span class="op">=</span><span class="va">False</span>,</span>
<span id="visualize_pca_animation-89"><a href="#visualize_pca_animation-89" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="visualize_pca_animation-90"><a href="#visualize_pca_animation-90" aria-hidden="true" tabindex="-1"></a>    plt.close(fig)</span>
<span id="visualize_pca_animation-91"><a href="#visualize_pca_animation-91" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> animation.to_html5_video()</span>
<span id="visualize_pca_animation-92"><a href="#visualize_pca_animation-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="visualize_pca_animation-93"><a href="#visualize_pca_animation-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="visualize_pca_animation-94"><a href="#visualize_pca_animation-94" aria-hidden="true" tabindex="-1"></a><span class="co"># display(HTML(animate_pca_transformation(data)))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Click on the animation above to visualize the PCA transformation!</p>
</div>
</div>
<p>As seen in the animation, we can transform our data to view the directions of maximum variance. These directions are the principal components of our data.</p>
</section>
<section id="the-mathematical-definition" class="level3">
<h3 class="anchored" data-anchor-id="the-mathematical-definition">The mathematical definition</h3>
<p>Given a data matrix <span class="math inline">X \in \mathbb{R}^{N \times P}</span>, we need to compute the <a href="../pages/reference.html#eigendecomposition">eigendecomposition</a><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> of its <a href="../pages/reference.html#auto-covariance">covariance</a><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>:</p>
<p><span class="math display">
\begin{align*}
    \text{cov}(X)
    &amp;= \left(\dfrac{1}{n - 1}\right) (X - \overline{X})^\top (X - \overline{X})\\
    &amp;= V \Lambda V^\top
\end{align*}
</span></p>
<p>To do this, we start by computing the covariance of our data matrix, where <span class="math inline">X</span> is centered (i.e.&nbsp;<span class="math inline">X - \overline{X}</span>)</p>
<p><img src="../resources/autocovariance.svg" class="img-fluid" style="width:100.0%"></p>
<p>Next , we compute the the eigendecomposition of the covariance (though the computational steps we take to get there are slightly different, as shown later)</p>
<p><img src="../resources/eigendecomposition.svg" class="img-fluid" style="width:100.0%"></p>
<p>The columns of <span class="math inline">V</span> are <em>eigenvectors</em> that specify the directions of variance while the corresponding diagonal elements of <span class="math inline">\Lambda</span> are <em>eigenvalues</em> that specify the amount of variance along the eigenvector<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.</p>
<p>Finally, the original data matrix can be transformed by projecting it onto the eigenvectors: <span class="math inline">\widetilde{X} = \left(X - \overline{X}\right) V</span>.</p>
<p><img src="../resources/projection.svg" class="img-fluid" style="width:80.0%"></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Viewing PCA as an optimization
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>PCA can be used to project data into a lower-dimensional space (i.e.&nbsp;<span class="math inline">p \le f</span>) in a way that best preserves the geometry of the data. Specifically, computing a PCA decomposition of <span class="math inline">X</span> yields a matrix <span class="math inline">V \in \mathbb{R}^{f \times p}</span> such that <span class="math inline">V = \argmin_{V \in \mathbb{U_{f \times p}}} \sum_{i=1}^n \left|| x_i - VV^\top x_i \right||_2</span>, where <span class="math inline">||\cdot||_2</span> denotes the <span class="math inline">L_2</span>-norm and <span class="math inline">\mathbb{U_{f \times p}}</span> denotes the set of orthonormal matrices with shape <span class="math inline">f \times p</span>.</p>
</div>
</div>
</div>
</section>
<section id="a-computational-recipe" class="level3">
<h3 class="anchored" data-anchor-id="a-computational-recipe">A computational recipe</h3>
<ol type="1">
<li>Center the data matrix.</li>
<li>Compute its singular value decomposition<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>.</li>
<li>The right singular vectors <span class="math inline">V</span> of the data matrix are the eigenvectors of its covariance.</li>
<li>The singular values <span class="math inline">\Sigma</span> of the data matrix are related to the eigenvalues <span class="math inline">\Lambda</span> of its covariance as <span class="math inline">\Lambda = \Sigma^2 / (N - 1)</span></li>
<li>To project data from the ambient space to the latent space, we must subtract the mean computed in Step 1, and multiply the data by the eigenvectors.</li>
</ol>
<div id="recipe-pca" class="cell" data-execution_count="17">
<details open="">
<summary>A computational recipe for PCA</summary>
<div class="sourceCode cell-code" id="recipe-pca"><pre class="sourceCode python code-annotation-code code-with-copy"><code class="sourceCode python"><span id="recipe-pca-1"><a href="#recipe-pca-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PCA:</span>
<span id="recipe-pca-2"><a href="#recipe-pca-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="recipe-pca-3"><a href="#recipe-pca-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.mean: np.ndarray</span>
<span id="recipe-pca-4"><a href="#recipe-pca-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.eigenvectors: np.ndarray</span>
<span id="recipe-pca-5"><a href="#recipe-pca-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.eigenvalues: np.ndarray</span>
<span id="recipe-pca-6"><a href="#recipe-pca-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="recipe-pca-7"><a href="#recipe-pca-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, <span class="op">/</span>, data: np.ndarray) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="recipe-pca-8"><a href="#recipe-pca-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.mean <span class="op">=</span> data.mean(axis<span class="op">=-</span><span class="dv">2</span>)</span>
<span id="recipe-pca-9"><a href="#recipe-pca-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="recipe-pca-10"><a href="#recipe-pca-10" aria-hidden="true" tabindex="-1"></a>        data_centered <span class="op">=</span> data <span class="op">-</span> <span class="va">self</span>.mean</span>
<span id="recipe-pca-11"><a href="#recipe-pca-11" aria-hidden="true" tabindex="-1"></a>        _, s, v_t <span class="op">=</span> np.linalg.svd(data_centered)</span>
<span id="recipe-pca-12"><a href="#recipe-pca-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="recipe-pca-13"><a href="#recipe-pca-13" aria-hidden="true" tabindex="-1"></a>        n_stimuli <span class="op">=</span> data.shape[<span class="op">-</span><span class="dv">2</span>]</span>
<span id="recipe-pca-14"><a href="#recipe-pca-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="recipe-pca-15"><a href="#recipe-pca-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.eigenvectors <span class="op">=</span> np.swapaxes(v_t, <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">2</span>)</span>
<span id="recipe-pca-16"><a href="#recipe-pca-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.eigenvalues <span class="op">=</span> s<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> (n_stimuli <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="recipe-pca-17"><a href="#recipe-pca-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="recipe-pca-18"><a href="#recipe-pca-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> transform(<span class="va">self</span>, <span class="op">/</span>, data: np.ndarray) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="recipe-pca-19"><a href="#recipe-pca-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (data <span class="op">-</span> <span class="va">self</span>.mean) <span class="op">@</span> <span class="va">self</span>.eigenvectors</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why do we compute PCA this way instead of <span class="math inline">\text{eig}(\text{cov}(X))</span>?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>To apply PCA to a data matrix, we might be tempted to use the definition and naively compute its <a href="../pages/reference.html#auto-covariance">covariance</a> followed by an <a href="../pages/reference.html#eigendecomposition">eigendecomposition</a>. However, when the number of neurons <span class="math inline">P</span> is large, this approach is memory-intensive and prone to numerical errors.</p>
<p>Instead, we can use the <a href="../pages/reference.html#singular-value-decomposition">singular value decomposition</a> (SVD) of <span class="math inline">X</span> to efficiently compute its PCA transformation. Specifically, <span class="math inline">X = U \Sigma V^\top</span> is a singular value decomposition, where <span class="math inline">U</span> and <span class="math inline">V</span> are orthonormal and <span class="math inline">\Sigma</span> is diagonal.</p>
<p>The covariance matrix reduces to <span class="math inline">X^\top X / (n - 1) = V \left(\frac{\Sigma^2}{n - 1} \right) V^\top</span>, which is exactly the eigendecomposition required.</p>
<p>Specifically, the eigenvalues <span class="math inline">\lambda_i</span> of the covariance matrix are related to the singular values <span class="math inline">\sigma_i</span> of the data matrix as <span class="math inline">\lambda_i = \sigma_i^2 / (N - 1)</span>, while the eigenvectors of the auto-covariance matrix are exactly the right singular vectors <span class="math inline">V</span> of the data matrix <span class="math inline">X</span>.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Only need the first few PCs?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Check out <a href="https://scikit-learn.org/stable/modules/generated/sklearn.decomposition.TruncatedSVD.html">truncated SVD</a>!</p>
</div>
</div>
</div>
</section>
</section>
<section id="transforming-the-dataset" class="level2">
<h2 class="anchored" data-anchor-id="transforming-the-dataset">Transforming the dataset</h2>
<p>Let’s now project our data into its principal components and analyse it in this space.</p>
<div id="cell-transforming-the-dataset" class="cell" data-execution_count="18">
<details>
<summary>Apply the PCA transformation</summary>
<div class="sourceCode cell-code" id="cell-transforming-the-dataset"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cell-transforming-the-dataset-1"><a href="#cell-transforming-the-dataset-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_pca(data: xr.DataArray) <span class="op">-&gt;</span> xr.Dataset:</span>
<span id="cell-transforming-the-dataset-2"><a href="#cell-transforming-the-dataset-2" aria-hidden="true" tabindex="-1"></a>    pca <span class="op">=</span> PCA()</span>
<span id="cell-transforming-the-dataset-3"><a href="#cell-transforming-the-dataset-3" aria-hidden="true" tabindex="-1"></a>    pca.fit(data.values)</span>
<span id="cell-transforming-the-dataset-4"><a href="#cell-transforming-the-dataset-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cell-transforming-the-dataset-5"><a href="#cell-transforming-the-dataset-5" aria-hidden="true" tabindex="-1"></a>    data_transformed <span class="op">=</span> pca.transform(data.values)</span>
<span id="cell-transforming-the-dataset-6"><a href="#cell-transforming-the-dataset-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cell-transforming-the-dataset-7"><a href="#cell-transforming-the-dataset-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> xr.Dataset(</span>
<span id="cell-transforming-the-dataset-8"><a href="#cell-transforming-the-dataset-8" aria-hidden="true" tabindex="-1"></a>        data_vars<span class="op">=</span>{</span>
<span id="cell-transforming-the-dataset-9"><a href="#cell-transforming-the-dataset-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"score"</span>: xr.DataArray(</span>
<span id="cell-transforming-the-dataset-10"><a href="#cell-transforming-the-dataset-10" aria-hidden="true" tabindex="-1"></a>                data<span class="op">=</span>data_transformed,</span>
<span id="cell-transforming-the-dataset-11"><a href="#cell-transforming-the-dataset-11" aria-hidden="true" tabindex="-1"></a>                dims<span class="op">=</span>(<span class="st">"stimulus"</span>, <span class="st">"component"</span>),</span>
<span id="cell-transforming-the-dataset-12"><a href="#cell-transforming-the-dataset-12" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cell-transforming-the-dataset-13"><a href="#cell-transforming-the-dataset-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"eigenvector"</span>: xr.DataArray(</span>
<span id="cell-transforming-the-dataset-14"><a href="#cell-transforming-the-dataset-14" aria-hidden="true" tabindex="-1"></a>                data<span class="op">=</span>pca.eigenvectors,</span>
<span id="cell-transforming-the-dataset-15"><a href="#cell-transforming-the-dataset-15" aria-hidden="true" tabindex="-1"></a>                dims<span class="op">=</span>(<span class="st">"component"</span>, <span class="st">"neuron"</span>),</span>
<span id="cell-transforming-the-dataset-16"><a href="#cell-transforming-the-dataset-16" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cell-transforming-the-dataset-17"><a href="#cell-transforming-the-dataset-17" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cell-transforming-the-dataset-18"><a href="#cell-transforming-the-dataset-18" aria-hidden="true" tabindex="-1"></a>        coords<span class="op">=</span>{</span>
<span id="cell-transforming-the-dataset-19"><a href="#cell-transforming-the-dataset-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">"rank"</span>: (<span class="st">"component"</span>, <span class="dv">1</span> <span class="op">+</span> np.arange(data_transformed.shape[<span class="op">-</span><span class="dv">1</span>])),</span>
<span id="cell-transforming-the-dataset-20"><a href="#cell-transforming-the-dataset-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">"eigenvalue"</span>: (<span class="st">"component"</span>, pca.eigenvalues),</span>
<span id="cell-transforming-the-dataset-21"><a href="#cell-transforming-the-dataset-21" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cell-transforming-the-dataset-22"><a href="#cell-transforming-the-dataset-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span> {coord: (data[coord].dims[<span class="dv">0</span>], data[coord].values) <span class="cf">for</span> coord <span class="kw">in</span> data.coords},</span>
<span id="cell-transforming-the-dataset-23"><a href="#cell-transforming-the-dataset-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cell-transforming-the-dataset-24"><a href="#cell-transforming-the-dataset-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cell-transforming-the-dataset-25"><a href="#cell-transforming-the-dataset-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cell-transforming-the-dataset-26"><a href="#cell-transforming-the-dataset-26" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> compute_pca(data)</span>
<span id="cell-transforming-the-dataset-27"><a href="#cell-transforming-the-dataset-27" aria-hidden="true" tabindex="-1"></a>display(pca[<span class="st">"score"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="transforming-the-dataset" class="cell-output cell-output-display">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewbox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewbox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class="xr-text-repr-fallback">&lt;xarray.DataArray 'score' (stimulus: 1000, component: 2)&gt;
11.19 1.269 -10.77 -1.394 -9.962 -1.541 ... -1.028 8.777 -5.869 3.39 -2.457
Coordinates: (3/5)
  * stimulus    (stimulus) int64 1 2 3 4 5 6 7 ... 994 995 996 997 998 999 1000
    rank        (component) int64 1 2
    ...          ...
    size        (stimulus) float64 0.01301 0.8278 0.4962 ... 0.08158 0.3216
Dimensions without coordinates: component</pre><div class="xr-wrap" style="display:none"><div class="xr-header"><div class="xr-obj-type">xarray.DataArray</div><div class="xr-array-name">'score'</div><ul class="xr-dim-list"><li><span class="xr-has-index">stimulus</span>: 1000</li><li><span>component</span>: 2</li></ul></div><ul class="xr-sections"><li class="xr-section-item"><div class="xr-array-wrap"><input id="section-1ee35815-fc81-4ae2-8a6e-a5c680d146b5" class="xr-array-in" type="checkbox"><label for="section-1ee35815-fc81-4ae2-8a6e-a5c680d146b5" title="Show/hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-array-preview xr-preview"><span>11.19 1.269 -10.77 -1.394 -9.962 ... -1.028 8.777 -5.869 3.39 -2.457</span></div><div class="xr-array-data"><pre>array([[ 1.11911792e+01,  1.26889981e+00],
       [-1.07729551e+01, -1.39397546e+00],
       [-9.96219137e+00, -1.54107707e+00],
       ...,
       [ 6.58127224e-03, -1.02783716e+00],
       [ 8.77667289e+00, -5.86946476e+00],
       [ 3.39020249e+00, -2.45675640e+00]])</pre></div></div></li><li class="xr-section-item"><input id="section-27183d8a-f120-4577-a3cc-0442c8fb9c36" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-27183d8a-f120-4577-a3cc-0442c8fb9c36" class="xr-section-summary">Coordinates: <span>(5)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">stimulus</span></div><div class="xr-var-dims">(stimulus)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">1 2 3 4 5 ... 996 997 998 999 1000</div><input id="attrs-5ec839b8-b486-4ed2-b3f6-9f5a90be2790" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-5ec839b8-b486-4ed2-b3f6-9f5a90be2790" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-e35cfc77-5bce-47bb-8646-2f1a475c92ec" class="xr-var-data-in" type="checkbox"><label for="data-e35cfc77-5bce-47bb-8646-2f1a475c92ec" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([   1,    2,    3, ...,  998,  999, 1000])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>rank</span></div><div class="xr-var-dims">(component)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">1 2</div><input id="attrs-3d1a9554-dbf3-4a99-ad9b-eb6e391f5bcb" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-3d1a9554-dbf3-4a99-ad9b-eb6e391f5bcb" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-b8156c38-23ce-4720-967f-67ad89c2b3b7" class="xr-var-data-in" type="checkbox"><label for="data-b8156c38-23ce-4720-967f-67ad89c2b3b7" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([1, 2])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>eigenvalue</span></div><div class="xr-var-dims">(component)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">46.3 6.148</div><input id="attrs-061bdcd8-e6c8-4585-ba80-1ea83b9213e9" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-061bdcd8-e6c8-4585-ba80-1ea83b9213e9" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-7add8e9e-b21a-4d78-a105-fc16ac553c6e" class="xr-var-data-in" type="checkbox"><label for="data-7add8e9e-b21a-4d78-a105-fc16ac553c6e" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([46.29579973,  6.14792569])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>color</span></div><div class="xr-var-dims">(stimulus)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">0.637 0.2698 ... 0.1649 0.38</div><input id="attrs-99d6008f-bb31-42d9-98f6-48cc6604ef4e" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-99d6008f-bb31-42d9-98f6-48cc6604ef4e" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-dab362f5-c8ac-48ef-b772-64b9733c797b" class="xr-var-data-in" type="checkbox"><label for="data-dab362f5-c8ac-48ef-b772-64b9733c797b" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([6.36961687e-01, 2.69786714e-01, 4.09735239e-02, 1.65276355e-02,
       8.13270239e-01, 9.12755577e-01, 6.06635776e-01, 7.29496561e-01,
       5.43624991e-01, 9.35072424e-01, 8.15853554e-01, 2.73850017e-03,
       8.57404277e-01, 3.35855753e-02, 7.29655446e-01, 1.75655621e-01,
       8.63178922e-01, 5.41461220e-01, 2.99711891e-01, 4.22687221e-01,
       2.83196711e-02, 1.24283276e-01, 6.70624415e-01, 6.47189512e-01,
       6.15385111e-01, 3.83677554e-01, 9.97209936e-01, 9.80835339e-01,
       6.85541984e-01, 6.50459276e-01, 6.88446731e-01, 3.88921424e-01,
       1.35096505e-01, 7.21488340e-01, 5.25354322e-01, 3.10241876e-01,
       4.85835359e-01, 8.89487834e-01, 9.34043516e-01, 3.57795197e-01,
       5.71529831e-01, 3.21869391e-01, 5.94300030e-01, 3.37911226e-01,
       3.91619001e-01, 8.90274352e-01, 2.27157594e-01, 6.23187145e-01,
       8.40153436e-02, 8.32644148e-01, 7.87098307e-01, 2.39369443e-01,
       8.76484231e-01, 5.85680348e-02, 3.36117061e-01, 1.50279467e-01,
       4.50339367e-01, 7.96324270e-01, 2.30642209e-01, 5.20213011e-02,
       4.04551840e-01, 1.98513045e-01, 9.07530456e-02, 5.80332386e-01,
       2.98696133e-01, 6.71994878e-01, 1.99515444e-01, 9.42113111e-01,
       3.65110168e-01, 1.05495280e-01, 6.29108152e-01, 9.27154553e-01,
       4.40377155e-01, 9.54590494e-01, 4.99895814e-01, 4.25228625e-01,
       6.20213452e-01, 9.95096505e-01, 9.48943675e-01, 4.60045139e-01,
...
       3.39811155e-01, 2.21699710e-04, 4.82537622e-01, 6.08000665e-01,
       9.29904601e-02, 2.42094402e-01, 8.03991821e-01, 8.40281560e-01,
       3.87733254e-01, 8.14223731e-01, 2.77140253e-01, 7.06108222e-01,
       5.45456624e-01, 4.40099079e-01, 6.56442276e-01, 1.33906791e-02,
       1.62443443e-01, 2.93823464e-01, 6.80562610e-01, 7.06235313e-01,
       6.80760824e-01, 7.67617107e-01, 7.95515610e-02, 1.05888908e-01,
       8.55351160e-01, 3.56837753e-01, 5.68371290e-01, 5.03502806e-01,
       6.26662571e-01, 7.69467112e-02, 7.69790226e-01, 1.23402328e-01,
       6.81374462e-01, 4.02142099e-01, 4.92261636e-01, 6.71693734e-01,
       3.71002751e-01, 4.60374714e-02, 9.64211552e-01, 5.22676899e-01,
       7.42144641e-01, 5.31294834e-01, 8.19686903e-01, 5.64616179e-01,
       1.22756878e-01, 6.41906565e-01, 1.72740669e-01, 8.23654135e-01,
       6.81061600e-01, 9.39808638e-01, 6.29080790e-01, 2.25163097e-01,
       5.57137546e-01, 7.71772277e-01, 7.11888298e-01, 3.42296706e-01,
       6.55351151e-01, 9.35269061e-01, 6.84810043e-01, 3.67301402e-01,
       9.10758330e-01, 8.27624193e-01, 8.55183760e-01, 1.06841377e-01,
       2.90828834e-01, 7.90127803e-01, 2.74807496e-01, 7.37059356e-02,
       6.83266012e-01, 7.99269956e-01, 6.41767808e-01, 3.44843336e-01,
       5.59773319e-01, 2.15199514e-02, 5.62661656e-01, 8.56801175e-01,
       7.80532350e-02, 3.83319397e-01, 1.64863718e-01, 3.80007897e-01])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>size</span></div><div class="xr-var-dims">(stimulus)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">0.01301 0.8278 ... 0.08158 0.3216</div><input id="attrs-a650aed2-4fd4-44a7-bc1b-eb55a7996366" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-a650aed2-4fd4-44a7-bc1b-eb55a7996366" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-3c7e8769-cfff-4f64-ae40-8e33b023746c" class="xr-var-data-in" type="checkbox"><label for="data-3c7e8769-cfff-4f64-ae40-8e33b023746c" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([0.01300767, 0.82776292, 0.49624331, 0.43591807, 0.60179472,
       0.8500282 , 0.29126072, 0.26751697, 0.04949421, 0.26639909,
       0.06621185, 0.04155849, 0.55273056, 0.18383489, 0.07425772,
       0.91671474, 0.14873389, 0.09483079, 0.97067806, 0.66696696,
       0.72575404, 0.563204  , 0.07038971, 0.84187724, 0.418029  ,
       0.39246782, 0.13530924, 0.11321989, 0.52224593, 0.56874359,
       0.51868554, 0.61312468, 0.87764346, 0.50420484, 0.37914768,
       0.2565727 , 0.30684664, 0.56080705, 0.79537234, 0.44112103,
       0.04076233, 0.1881545 , 0.09065223, 0.33334341, 0.68437666,
       0.59071473, 0.66212759, 0.45459513, 0.10978054, 0.29625596,
       0.51096048, 0.49716497, 0.24366139, 0.82530156, 0.43331334,
       0.84545613, 0.26549263, 0.94193959, 0.11185735, 0.76918249,
       0.02018645, 0.23632066, 0.8705533 , 0.350105  , 0.93247949,
       0.929417  , 0.80019258, 0.39610545, 0.8582685 , 0.45710434,
       0.1261722 , 0.85195837, 0.8162467 , 0.13556544, 0.86652652,
       0.51896305, 0.74359076, 0.26817602, 0.21546148, 0.84831281,
       0.6002138 , 0.14770547, 0.36587009, 0.85903582, 0.46828358,
       0.3368529 , 0.34095386, 0.8246442 , 0.45429903, 0.9483535 ,
       0.31220015, 0.75648033, 0.28570549, 0.7678388 , 0.01759798,
       0.12982098, 0.25925691, 0.87009196, 0.32249838, 0.48352554,
...
       0.25857775, 0.09677339, 0.18039325, 0.25448073, 0.83934999,
       0.22122572, 0.82839782, 0.74329961, 0.97429452, 0.75359014,
       0.11511305, 0.94004275, 0.84209462, 0.4436286 , 0.43358894,
       0.03095428, 0.21764154, 0.71488612, 0.1105268 , 0.99174489,
       0.02168247, 0.99097346, 0.29620757, 0.46086521, 0.54547145,
       0.28955319, 0.22049757, 0.0505692 , 0.823433  , 0.97230937,
       0.12555748, 0.85983084, 0.72053945, 0.75022534, 0.38780546,
       0.05757491, 0.69042312, 0.96212643, 0.65875825, 0.23405231,
       0.53673526, 0.12167514, 0.71787855, 0.67286419, 0.446794  ,
       0.00866449, 0.06036607, 0.68197769, 0.69241334, 0.57520933,
       0.22769122, 0.66313159, 0.1055052 , 0.62768057, 0.57231791,
       0.35549364, 0.21916604, 0.7245827 , 0.18099196, 0.15735466,
       0.63276412, 0.66062453, 0.1019691 , 0.26228831, 0.09859603,
       0.91383146, 0.00838652, 0.35101158, 0.15682101, 0.46699488,
       0.90683736, 0.70737638, 0.36017375, 0.1866537 , 0.70501213,
       0.54191587, 0.72028997, 0.04485529, 0.17314062, 0.3198733 ,
       0.4665367 , 0.56944602, 0.56209399, 0.54291566, 0.56611634,
       0.41747562, 0.27881285, 0.51812954, 0.12186051, 0.74927137,
       0.95293572, 0.05409649, 0.78232714, 0.22383289, 0.33641135,
       0.03353818, 0.9690858 , 0.56209561, 0.08158143, 0.32155563])</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-3044a4ce-52c4-4cf6-8a97-1250d41c5f3a" class="xr-section-summary-in" type="checkbox"><label for="section-3044a4ce-52c4-4cf6-8a97-1250d41c5f3a" class="xr-section-summary">Indexes: <span>(1)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-index-name"><div>stimulus</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-4b0bc80e-e554-4969-bf5d-6ad68324078d" class="xr-index-data-in" type="checkbox"><label for="index-4b0bc80e-e554-4969-bf5d-6ad68324078d" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([   1,    2,    3,    4,    5,    6,    7,    8,    9,   10,
       ...
        991,  992,  993,  994,  995,  996,  997,  998,  999, 1000],
      dtype='int64', name='stimulus', length=1000))</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-6996cb4e-7b44-471d-bac1-ca0fd829e77c" class="xr-section-summary-in" type="checkbox" disabled=""><label for="section-6996cb4e-7b44-471d-bac1-ca0fd829e77c" class="xr-section-summary" title="Expand/collapse section">Attributes: <span>(0)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><dl class="xr-attrs"></dl></div></li></ul></div></div>
</div>
</div>
<section id="inspecting-the-eigenvectors" class="level3">
<h3 class="anchored" data-anchor-id="inspecting-the-eigenvectors">Inspecting the eigenvectors</h3>
<p>The eigenvectors represent the directions of maximum variance in our data.</p>
<div id="92806e6f" class="cell" data-execution_count="19">
<details>
<summary>Display the eigenvectors</summary>
<div class="sourceCode cell-code" id="92806e6f"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="92806e6f-1"><a href="#92806e6f-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> xr.set_options(display_expand_data<span class="op">=</span><span class="va">True</span>):</span>
<span id="92806e6f-2"><a href="#92806e6f-2" aria-hidden="true" tabindex="-1"></a>    display(pca[<span class="st">"eigenvector"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewbox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewbox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class="xr-text-repr-fallback">&lt;xarray.DataArray 'eigenvector' (component: 2, neuron: 2)&gt;
array([[ 0.43538525,  0.90024423],
       [-0.90024423,  0.43538525]])
Coordinates: (3/7)
  * neuron      (neuron) int64 1 2
    rank        (component) int64 1 2
    ...          ...
    std         (neuron) float64 1.0 3.0
Dimensions without coordinates: component</pre><div class="xr-wrap" style="display:none"><div class="xr-header"><div class="xr-obj-type">xarray.DataArray</div><div class="xr-array-name">'eigenvector'</div><ul class="xr-dim-list"><li><span>component</span>: 2</li><li><span class="xr-has-index">neuron</span>: 2</li></ul></div><ul class="xr-sections"><li class="xr-section-item"><div class="xr-array-wrap"><input id="section-0fc516b3-1069-4e62-803a-4a8f2c19b159" class="xr-array-in" type="checkbox" checked=""><label for="section-0fc516b3-1069-4e62-803a-4a8f2c19b159" title="Show/hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-array-preview xr-preview"><span>0.4354 0.9002 -0.9002 0.4354</span></div><div class="xr-array-data"><pre>array([[ 0.43538525,  0.90024423],
       [-0.90024423,  0.43538525]])</pre></div></div></li><li class="xr-section-item"><input id="section-0b77889f-e40f-49f8-a0a4-27f08d2b07fa" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-0b77889f-e40f-49f8-a0a4-27f08d2b07fa" class="xr-section-summary">Coordinates: <span>(7)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">neuron</span></div><div class="xr-var-dims">(neuron)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">1 2</div><input id="attrs-d5621d8a-d2b4-4697-ba77-7eb5fdb4b2ea" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-d5621d8a-d2b4-4697-ba77-7eb5fdb4b2ea" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-df376eb2-da1c-4d5f-8ec1-e619615caad6" class="xr-var-data-in" type="checkbox"><label for="data-df376eb2-da1c-4d5f-8ec1-e619615caad6" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([1, 2])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>rank</span></div><div class="xr-var-dims">(component)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">1 2</div><input id="attrs-d3cc459c-9a49-4a3b-9750-851146ceb721" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-d3cc459c-9a49-4a3b-9750-851146ceb721" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-c755498d-b9c2-4578-81e3-b558dff3188e" class="xr-var-data-in" type="checkbox"><label for="data-c755498d-b9c2-4578-81e3-b558dff3188e" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([1, 2])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>eigenvalue</span></div><div class="xr-var-dims">(component)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">46.3 6.148</div><input id="attrs-d72ef3f1-29c0-42c7-96bb-5bbda23e27b0" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-d72ef3f1-29c0-42c7-96bb-5bbda23e27b0" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-c6f50723-7359-4cb6-a914-e6de16ac11b3" class="xr-var-data-in" type="checkbox"><label for="data-c6f50723-7359-4cb6-a914-e6de16ac11b3" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([46.29579973,  6.14792569])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>beta_color</span></div><div class="xr-var-dims">(neuron)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">3.0 -2.0</div><input id="attrs-44f9af6c-a0e4-48e9-b6ce-3232aacdda8c" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-44f9af6c-a0e4-48e9-b6ce-3232aacdda8c" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-8a13d8d5-5def-4e77-b9ea-1f997edf4616" class="xr-var-data-in" type="checkbox"><label for="data-8a13d8d5-5def-4e77-b9ea-1f997edf4616" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([ 3., -2.])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>beta_size</span></div><div class="xr-var-dims">(neuron)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">-2.0 5.0</div><input id="attrs-2e093dae-f0de-41dd-8c85-d26a0066ac1d" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-2e093dae-f0de-41dd-8c85-d26a0066ac1d" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-1ede1ca1-ca21-43be-b448-a742acc385c8" class="xr-var-data-in" type="checkbox"><label for="data-1ede1ca1-ca21-43be-b448-a742acc385c8" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([-2.,  5.])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>mean</span></div><div class="xr-var-dims">(neuron)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">7.0 -6.0</div><input id="attrs-272adfd8-1f21-4421-9966-0e2d0f55aaa7" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-272adfd8-1f21-4421-9966-0e2d0f55aaa7" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-eb2a3d2e-dac9-4d4b-80a1-09f01f783bd8" class="xr-var-data-in" type="checkbox"><label for="data-eb2a3d2e-dac9-4d4b-80a1-09f01f783bd8" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([ 7., -6.])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>std</span></div><div class="xr-var-dims">(neuron)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">1.0 3.0</div><input id="attrs-c11a5374-86bd-4b3e-8d4e-42df89226850" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-c11a5374-86bd-4b3e-8d4e-42df89226850" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-8c78b3c0-b98e-4464-9af3-f02941db8b5a" class="xr-var-data-in" type="checkbox"><label for="data-8c78b3c0-b98e-4464-9af3-f02941db8b5a" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([1., 3.])</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-315c1c4b-913b-4b9c-b336-fd1920603847" class="xr-section-summary-in" type="checkbox"><label for="section-315c1c4b-913b-4b9c-b336-fd1920603847" class="xr-section-summary">Indexes: <span>(1)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-index-name"><div>neuron</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-bc3dc687-2940-4d63-b719-e33fea4f9cf5" class="xr-index-data-in" type="checkbox"><label for="index-bc3dc687-2940-4d63-b719-e33fea4f9cf5" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([1, 2], dtype='int64', name='neuron'))</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-eb0d8f34-7705-46c5-957c-8666cd409bb8" class="xr-section-summary-in" type="checkbox" disabled=""><label for="section-eb0d8f34-7705-46c5-957c-8666cd409bb8" class="xr-section-summary" title="Expand/collapse section">Attributes: <span>(0)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><dl class="xr-attrs"></dl></div></li></ul></div></div>
</div>
</div>
</section>
<section id="interpreting-the-transformed-data" class="level3">
<h3 class="anchored" data-anchor-id="interpreting-the-transformed-data">Interpreting the transformed data</h3>
<p>We can view the data projected onto each of the principal components.</p>
<div id="cell-view_principal_components" class="cell" data-execution_count="20">
<details>
<summary>Visualize principal component scores</summary>
<div class="sourceCode cell-code" id="cell-view_principal_components"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cell-view_principal_components-1"><a href="#cell-view_principal_components-1" aria-hidden="true" tabindex="-1"></a>view_individual_scatter(</span>
<span id="cell-view_principal_components-2"><a href="#cell-view_principal_components-2" aria-hidden="true" tabindex="-1"></a>    pca[<span class="st">"score"</span>],</span>
<span id="cell-view_principal_components-3"><a href="#cell-view_principal_components-3" aria-hidden="true" tabindex="-1"></a>    coord<span class="op">=</span><span class="st">"rank"</span>,</span>
<span id="cell-view_principal_components-4"><a href="#cell-view_principal_components-4" aria-hidden="true" tabindex="-1"></a>    dim<span class="op">=</span><span class="st">"component"</span>,</span>
<span id="cell-view_principal_components-5"><a href="#cell-view_principal_components-5" aria-hidden="true" tabindex="-1"></a>    template_func<span class="op">=</span><span class="kw">lambda</span> x: <span class="ss">f"principal component </span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cell-view_principal_components-6"><a href="#cell-view_principal_components-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="18">
<div id="view_principal_components" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="introducing_pca_files/figure-html/view_principal_components-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We observe that:</p>
<ul>
<li>the <em>first</em> principal component is largely driven by the <em>size</em> of the stimulus</li>
<li>the <em>second</em> principal component is largely driven by the <em>color</em> of the stimulus</li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that these components do <em>not</em> directly correspond to either of the latent variables. Rather, each is a mixture of stimulus-dependent signal and noise.</p>
</div>
</div>
</section>
<section id="inspecting-the-eigenspectrum" class="level3">
<h3 class="anchored" data-anchor-id="inspecting-the-eigenspectrum">Inspecting the eigenspectrum</h3>
<p>The eigenvalues show the variance along each eigenvector. The sum of the eigenvalues is therefore equal to the total variance.</p>
<div id="eigenvalues" class="cell" data-execution_count="21">
<details>
<summary>Display eigenvalues</summary>
<div class="sourceCode cell-code" id="eigenvalues"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="eigenvalues-1"><a href="#eigenvalues-1" aria-hidden="true" tabindex="-1"></a>eigenvalues <span class="op">=</span> pca[<span class="st">"eigenvalue"</span>].<span class="bu">round</span>(<span class="dv">3</span>)</span>
<span id="eigenvalues-2"><a href="#eigenvalues-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i_neuron <span class="kw">in</span> <span class="bu">range</span>(eigenvalues.sizes[<span class="st">"component"</span>]):</span>
<span id="eigenvalues-3"><a href="#eigenvalues-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(</span>
<span id="eigenvalues-4"><a href="#eigenvalues-4" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"variance along eigenvector </span><span class="sc">{</span>i_neuron <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss"> (eigenvalue </span><span class="sc">{</span>i_neuron <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">):"</span></span>
<span id="eigenvalues-5"><a href="#eigenvalues-5" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f" </span><span class="sc">{</span>eigenvalues[i_neuron]<span class="sc">.</span>values<span class="sc">}</span><span class="ss">"</span></span>
<span id="eigenvalues-6"><a href="#eigenvalues-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="eigenvalues-7"><a href="#eigenvalues-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"total variance: </span><span class="sc">{</span>eigenvalues<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">.</span>values<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>variance along eigenvector 1 (eigenvalue 1): 46.296
variance along eigenvector 2 (eigenvalue 2): 6.148
total variance: 52.444</code></pre>
</div>
</div>
<p>We can also see that this is equal to the total variance in the original data.</p>
<div id="variance" class="cell" data-execution_count="22">
<details>
<summary>Compute total variance in the original data</summary>
<div class="sourceCode cell-code" id="variance"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="variance-1"><a href="#variance-1" aria-hidden="true" tabindex="-1"></a>variances <span class="op">=</span> data.var(dim<span class="op">=</span><span class="st">"stimulus"</span>, ddof<span class="op">=</span><span class="dv">1</span>).<span class="bu">round</span>(<span class="dv">3</span>).rename(<span class="st">"neuron variances"</span>)</span>
<span id="variance-2"><a href="#variance-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i_neuron <span class="kw">in</span> <span class="bu">range</span>(variances.sizes[<span class="st">"neuron"</span>]):</span>
<span id="variance-3"><a href="#variance-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"variance of neuron </span><span class="sc">{</span>i_neuron <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss"> responses: </span><span class="sc">{</span>variances[i_neuron]<span class="sc">.</span>values<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="variance-4"><a href="#variance-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"total variance: </span><span class="sc">{</span>variances<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">.</span>values<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>variance of neuron 1 responses: 13.758
variance of neuron 2 responses: 38.685
total variance: 52.443</code></pre>
</div>
</div>
<p>We can plot the eigenvalues as a function of their rank to visualize the <em>eigensceptrum</em>. As we will see shortly, the eigenspectrum provides valuable insights about the laten dimensionality of the data.</p>
<div id="cell-visualize_eigenspectrum" class="cell" data-execution_count="23">
<details>
<summary>View eigenspectrum</summary>
<div class="sourceCode cell-code" id="cell-visualize_eigenspectrum"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cell-visualize_eigenspectrum-1"><a href="#cell-visualize_eigenspectrum-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> view_eigenspectrum(pca: xr.DataArray) <span class="op">-&gt;</span> Figure:</span>
<span id="cell-visualize_eigenspectrum-2"><a href="#cell-visualize_eigenspectrum-2" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(pca.sizes[<span class="st">"component"</span>], <span class="dv">5</span>))</span>
<span id="cell-visualize_eigenspectrum-3"><a href="#cell-visualize_eigenspectrum-3" aria-hidden="true" tabindex="-1"></a>    sns.lineplot(</span>
<span id="cell-visualize_eigenspectrum-4"><a href="#cell-visualize_eigenspectrum-4" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>ax,</span>
<span id="cell-visualize_eigenspectrum-5"><a href="#cell-visualize_eigenspectrum-5" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>pca[<span class="st">"component"</span>].to_dataframe(),</span>
<span id="cell-visualize_eigenspectrum-6"><a href="#cell-visualize_eigenspectrum-6" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"rank"</span>,</span>
<span id="cell-visualize_eigenspectrum-7"><a href="#cell-visualize_eigenspectrum-7" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"eigenvalue"</span>,</span>
<span id="cell-visualize_eigenspectrum-8"><a href="#cell-visualize_eigenspectrum-8" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="st">"s"</span>,</span>
<span id="cell-visualize_eigenspectrum-9"><a href="#cell-visualize_eigenspectrum-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cell-visualize_eigenspectrum-10"><a href="#cell-visualize_eigenspectrum-10" aria-hidden="true" tabindex="-1"></a>    ax.set_xticks(pca[<span class="st">"rank"</span>].values)</span>
<span id="cell-visualize_eigenspectrum-11"><a href="#cell-visualize_eigenspectrum-11" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim(bottom<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cell-visualize_eigenspectrum-12"><a href="#cell-visualize_eigenspectrum-12" aria-hidden="true" tabindex="-1"></a>    sns.despine(ax<span class="op">=</span>ax, offset<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cell-visualize_eigenspectrum-13"><a href="#cell-visualize_eigenspectrum-13" aria-hidden="true" tabindex="-1"></a>    plt.close(fig)</span>
<span id="cell-visualize_eigenspectrum-14"><a href="#cell-visualize_eigenspectrum-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cell-visualize_eigenspectrum-15"><a href="#cell-visualize_eigenspectrum-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cell-visualize_eigenspectrum-16"><a href="#cell-visualize_eigenspectrum-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cell-visualize_eigenspectrum-17"><a href="#cell-visualize_eigenspectrum-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cell-visualize_eigenspectrum-18"><a href="#cell-visualize_eigenspectrum-18" aria-hidden="true" tabindex="-1"></a>view_eigenspectrum(pca)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="21">
<div id="visualize_eigenspectrum" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="introducing_pca_files/figure-html/visualize_eigenspectrum-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="quantifying-dimensionality" class="level2">
<h2 class="anchored" data-anchor-id="quantifying-dimensionality">Quantifying dimensionality</h2>
<p>In these data, the dimensionality is clear: there are two latent variables and both are evident in the principal components. However, in real data, we typically record from more than <span class="math inline">P = 2</span> neurons, therefore judging the dimensionality becomes tricky. To simulate such a scenario, let’s record from more neurons (say <span class="math inline">P = 10</span>).</p>
<div id="cell-simulate_more_neurons" class="cell" data-execution_count="24">
<details>
<summary>Simulate responses from more neurons</summary>
<div class="sourceCode cell-code" id="cell-simulate_more_neurons"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cell-simulate_more_neurons-1"><a href="#cell-simulate_more_neurons-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _simulate_random_neuron(rng: np.random.Generator) <span class="op">-&gt;</span> Neuron:</span>
<span id="cell-simulate_more_neurons-2"><a href="#cell-simulate_more_neurons-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Neuron(</span>
<span id="cell-simulate_more_neurons-3"><a href="#cell-simulate_more_neurons-3" aria-hidden="true" tabindex="-1"></a>        beta_color<span class="op">=</span>rng.integers(<span class="op">-</span><span class="dv">10</span>, <span class="dv">11</span>),</span>
<span id="cell-simulate_more_neurons-4"><a href="#cell-simulate_more_neurons-4" aria-hidden="true" tabindex="-1"></a>        beta_size<span class="op">=</span>rng.integers(<span class="op">-</span><span class="dv">10</span>, <span class="dv">11</span>),</span>
<span id="cell-simulate_more_neurons-5"><a href="#cell-simulate_more_neurons-5" aria-hidden="true" tabindex="-1"></a>        std<span class="op">=</span>rng.integers(<span class="op">-</span><span class="dv">10</span>, <span class="dv">11</span>),</span>
<span id="cell-simulate_more_neurons-6"><a href="#cell-simulate_more_neurons-6" aria-hidden="true" tabindex="-1"></a>        mean<span class="op">=</span>rng.integers(<span class="op">-</span><span class="dv">10</span>, <span class="dv">11</span>),</span>
<span id="cell-simulate_more_neurons-7"><a href="#cell-simulate_more_neurons-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cell-simulate_more_neurons-8"><a href="#cell-simulate_more_neurons-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cell-simulate_more_neurons-9"><a href="#cell-simulate_more_neurons-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cell-simulate_more_neurons-10"><a href="#cell-simulate_more_neurons-10" aria-hidden="true" tabindex="-1"></a>neurons <span class="op">=</span> <span class="bu">tuple</span>([_simulate_random_neuron(rng) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>)])</span>
<span id="cell-simulate_more_neurons-11"><a href="#cell-simulate_more_neurons-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cell-simulate_more_neurons-12"><a href="#cell-simulate_more_neurons-12" aria-hidden="true" tabindex="-1"></a>big_data <span class="op">=</span> simulate_multiple_neuron_responses(</span>
<span id="cell-simulate_more_neurons-13"><a href="#cell-simulate_more_neurons-13" aria-hidden="true" tabindex="-1"></a>    stimuli<span class="op">=</span>stimuli,</span>
<span id="cell-simulate_more_neurons-14"><a href="#cell-simulate_more_neurons-14" aria-hidden="true" tabindex="-1"></a>    neurons<span class="op">=</span>neurons,</span>
<span id="cell-simulate_more_neurons-15"><a href="#cell-simulate_more_neurons-15" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">=</span>rng,</span>
<span id="cell-simulate_more_neurons-16"><a href="#cell-simulate_more_neurons-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cell-simulate_more_neurons-17"><a href="#cell-simulate_more_neurons-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cell-simulate_more_neurons-18"><a href="#cell-simulate_more_neurons-18" aria-hidden="true" tabindex="-1"></a>display(big_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="simulate_more_neurons" class="cell-output cell-output-display">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewbox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewbox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class="xr-text-repr-fallback">&lt;xarray.DataArray 'neuron responses' (stimulus: 1000, neuron: 10)&gt;
-1.747 -8.53 -7.006 4.696 8.766 28.16 ... 8.782 0.7017 -2.132 -1.981 -1.87
Coordinates: (3/8)
  * neuron      (neuron) int64 1 2 3 4 5 6 7 8 9 10
  * stimulus    (stimulus) int64 1 2 3 4 5 6 7 ... 994 995 996 997 998 999 1000
    ...          ...
    std         (neuron) float64 -5.0 2.0 -3.0 5.0 -10.0 ... -2.0 -4.0 -2.0 -8.0</pre><div class="xr-wrap" style="display:none"><div class="xr-header"><div class="xr-obj-type">xarray.DataArray</div><div class="xr-array-name">'neuron responses'</div><ul class="xr-dim-list"><li><span class="xr-has-index">stimulus</span>: 1000</li><li><span class="xr-has-index">neuron</span>: 10</li></ul></div><ul class="xr-sections"><li class="xr-section-item"><div class="xr-array-wrap"><input id="section-0acb49a7-18fb-427f-88a8-122002737f4d" class="xr-array-in" type="checkbox"><label for="section-0acb49a7-18fb-427f-88a8-122002737f4d" title="Show/hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-array-preview xr-preview"><span>-1.747 -8.53 -7.006 4.696 8.766 ... 8.782 0.7017 -2.132 -1.981 -1.87</span></div><div class="xr-array-data"><pre>array([[ -1.7468685 ,  -8.52988047,  -7.00619911, ..., -12.08407229,
         -6.11588709,   5.79962078],
       [  0.5417999 ,   5.76857817, -14.19056082, ...,  -7.57254665,
         15.63044955, -12.08460524],
       [-15.14390287,   7.43798007, -11.87857537, ...,  -5.60388679,
          1.55649921,  -0.7286054 ],
       ...,
       [-11.867323  ,   3.04997894,  -8.19304571, ..., -13.63460347,
          7.49747562,  10.62648332],
       [-23.71380179,   4.65415007,  -5.80502762, ...,  -7.50271373,
        -10.13915485,  -8.14599889],
       [ -7.25947058,   1.02221347,  -8.99930611, ...,  -2.13177182,
         -1.98124877,  -1.87010738]])</pre></div></div></li><li class="xr-section-item"><input id="section-c15251c5-ac07-4e7e-91ad-e460d191874f" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-c15251c5-ac07-4e7e-91ad-e460d191874f" class="xr-section-summary">Coordinates: <span>(8)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">neuron</span></div><div class="xr-var-dims">(neuron)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">1 2 3 4 5 6 7 8 9 10</div><input id="attrs-d73773cb-791d-45b2-ade6-7865d33a4bd3" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-d73773cb-791d-45b2-ade6-7865d33a4bd3" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-e028c65e-1e0a-4b3d-a31b-f8db43f1a076" class="xr-var-data-in" type="checkbox"><label for="data-e028c65e-1e0a-4b3d-a31b-f8db43f1a076" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([ 1,  2,  3,  4,  5,  6,  7,  8,  9, 10])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">stimulus</span></div><div class="xr-var-dims">(stimulus)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">1 2 3 4 5 ... 996 997 998 999 1000</div><input id="attrs-26a822fc-e3ae-4719-8f06-6ae4aac510e1" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-26a822fc-e3ae-4719-8f06-6ae4aac510e1" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-09a0fa82-78e5-4530-b06a-73d19e6cc680" class="xr-var-data-in" type="checkbox"><label for="data-09a0fa82-78e5-4530-b06a-73d19e6cc680" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([   1,    2,    3, ...,  998,  999, 1000])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>color</span></div><div class="xr-var-dims">(stimulus)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">0.637 0.2698 ... 0.1649 0.38</div><input id="attrs-280b14e9-647f-4713-be38-058a2b2204d7" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-280b14e9-647f-4713-be38-058a2b2204d7" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-bff4be1c-7af7-4721-a041-97ccaf05426f" class="xr-var-data-in" type="checkbox"><label for="data-bff4be1c-7af7-4721-a041-97ccaf05426f" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([6.36961687e-01, 2.69786714e-01, 4.09735239e-02, 1.65276355e-02,
       8.13270239e-01, 9.12755577e-01, 6.06635776e-01, 7.29496561e-01,
       5.43624991e-01, 9.35072424e-01, 8.15853554e-01, 2.73850017e-03,
       8.57404277e-01, 3.35855753e-02, 7.29655446e-01, 1.75655621e-01,
       8.63178922e-01, 5.41461220e-01, 2.99711891e-01, 4.22687221e-01,
       2.83196711e-02, 1.24283276e-01, 6.70624415e-01, 6.47189512e-01,
       6.15385111e-01, 3.83677554e-01, 9.97209936e-01, 9.80835339e-01,
       6.85541984e-01, 6.50459276e-01, 6.88446731e-01, 3.88921424e-01,
       1.35096505e-01, 7.21488340e-01, 5.25354322e-01, 3.10241876e-01,
       4.85835359e-01, 8.89487834e-01, 9.34043516e-01, 3.57795197e-01,
       5.71529831e-01, 3.21869391e-01, 5.94300030e-01, 3.37911226e-01,
       3.91619001e-01, 8.90274352e-01, 2.27157594e-01, 6.23187145e-01,
       8.40153436e-02, 8.32644148e-01, 7.87098307e-01, 2.39369443e-01,
       8.76484231e-01, 5.85680348e-02, 3.36117061e-01, 1.50279467e-01,
       4.50339367e-01, 7.96324270e-01, 2.30642209e-01, 5.20213011e-02,
       4.04551840e-01, 1.98513045e-01, 9.07530456e-02, 5.80332386e-01,
       2.98696133e-01, 6.71994878e-01, 1.99515444e-01, 9.42113111e-01,
       3.65110168e-01, 1.05495280e-01, 6.29108152e-01, 9.27154553e-01,
       4.40377155e-01, 9.54590494e-01, 4.99895814e-01, 4.25228625e-01,
       6.20213452e-01, 9.95096505e-01, 9.48943675e-01, 4.60045139e-01,
...
       3.39811155e-01, 2.21699710e-04, 4.82537622e-01, 6.08000665e-01,
       9.29904601e-02, 2.42094402e-01, 8.03991821e-01, 8.40281560e-01,
       3.87733254e-01, 8.14223731e-01, 2.77140253e-01, 7.06108222e-01,
       5.45456624e-01, 4.40099079e-01, 6.56442276e-01, 1.33906791e-02,
       1.62443443e-01, 2.93823464e-01, 6.80562610e-01, 7.06235313e-01,
       6.80760824e-01, 7.67617107e-01, 7.95515610e-02, 1.05888908e-01,
       8.55351160e-01, 3.56837753e-01, 5.68371290e-01, 5.03502806e-01,
       6.26662571e-01, 7.69467112e-02, 7.69790226e-01, 1.23402328e-01,
       6.81374462e-01, 4.02142099e-01, 4.92261636e-01, 6.71693734e-01,
       3.71002751e-01, 4.60374714e-02, 9.64211552e-01, 5.22676899e-01,
       7.42144641e-01, 5.31294834e-01, 8.19686903e-01, 5.64616179e-01,
       1.22756878e-01, 6.41906565e-01, 1.72740669e-01, 8.23654135e-01,
       6.81061600e-01, 9.39808638e-01, 6.29080790e-01, 2.25163097e-01,
       5.57137546e-01, 7.71772277e-01, 7.11888298e-01, 3.42296706e-01,
       6.55351151e-01, 9.35269061e-01, 6.84810043e-01, 3.67301402e-01,
       9.10758330e-01, 8.27624193e-01, 8.55183760e-01, 1.06841377e-01,
       2.90828834e-01, 7.90127803e-01, 2.74807496e-01, 7.37059356e-02,
       6.83266012e-01, 7.99269956e-01, 6.41767808e-01, 3.44843336e-01,
       5.59773319e-01, 2.15199514e-02, 5.62661656e-01, 8.56801175e-01,
       7.80532350e-02, 3.83319397e-01, 1.64863718e-01, 3.80007897e-01])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>size</span></div><div class="xr-var-dims">(stimulus)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">0.01301 0.8278 ... 0.08158 0.3216</div><input id="attrs-2f576890-7e0f-484d-aad9-6cc1e82af2e6" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-2f576890-7e0f-484d-aad9-6cc1e82af2e6" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-0390fc70-a756-438e-88f0-c6699726d9c9" class="xr-var-data-in" type="checkbox"><label for="data-0390fc70-a756-438e-88f0-c6699726d9c9" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([0.01300767, 0.82776292, 0.49624331, 0.43591807, 0.60179472,
       0.8500282 , 0.29126072, 0.26751697, 0.04949421, 0.26639909,
       0.06621185, 0.04155849, 0.55273056, 0.18383489, 0.07425772,
       0.91671474, 0.14873389, 0.09483079, 0.97067806, 0.66696696,
       0.72575404, 0.563204  , 0.07038971, 0.84187724, 0.418029  ,
       0.39246782, 0.13530924, 0.11321989, 0.52224593, 0.56874359,
       0.51868554, 0.61312468, 0.87764346, 0.50420484, 0.37914768,
       0.2565727 , 0.30684664, 0.56080705, 0.79537234, 0.44112103,
       0.04076233, 0.1881545 , 0.09065223, 0.33334341, 0.68437666,
       0.59071473, 0.66212759, 0.45459513, 0.10978054, 0.29625596,
       0.51096048, 0.49716497, 0.24366139, 0.82530156, 0.43331334,
       0.84545613, 0.26549263, 0.94193959, 0.11185735, 0.76918249,
       0.02018645, 0.23632066, 0.8705533 , 0.350105  , 0.93247949,
       0.929417  , 0.80019258, 0.39610545, 0.8582685 , 0.45710434,
       0.1261722 , 0.85195837, 0.8162467 , 0.13556544, 0.86652652,
       0.51896305, 0.74359076, 0.26817602, 0.21546148, 0.84831281,
       0.6002138 , 0.14770547, 0.36587009, 0.85903582, 0.46828358,
       0.3368529 , 0.34095386, 0.8246442 , 0.45429903, 0.9483535 ,
       0.31220015, 0.75648033, 0.28570549, 0.7678388 , 0.01759798,
       0.12982098, 0.25925691, 0.87009196, 0.32249838, 0.48352554,
...
       0.25857775, 0.09677339, 0.18039325, 0.25448073, 0.83934999,
       0.22122572, 0.82839782, 0.74329961, 0.97429452, 0.75359014,
       0.11511305, 0.94004275, 0.84209462, 0.4436286 , 0.43358894,
       0.03095428, 0.21764154, 0.71488612, 0.1105268 , 0.99174489,
       0.02168247, 0.99097346, 0.29620757, 0.46086521, 0.54547145,
       0.28955319, 0.22049757, 0.0505692 , 0.823433  , 0.97230937,
       0.12555748, 0.85983084, 0.72053945, 0.75022534, 0.38780546,
       0.05757491, 0.69042312, 0.96212643, 0.65875825, 0.23405231,
       0.53673526, 0.12167514, 0.71787855, 0.67286419, 0.446794  ,
       0.00866449, 0.06036607, 0.68197769, 0.69241334, 0.57520933,
       0.22769122, 0.66313159, 0.1055052 , 0.62768057, 0.57231791,
       0.35549364, 0.21916604, 0.7245827 , 0.18099196, 0.15735466,
       0.63276412, 0.66062453, 0.1019691 , 0.26228831, 0.09859603,
       0.91383146, 0.00838652, 0.35101158, 0.15682101, 0.46699488,
       0.90683736, 0.70737638, 0.36017375, 0.1866537 , 0.70501213,
       0.54191587, 0.72028997, 0.04485529, 0.17314062, 0.3198733 ,
       0.4665367 , 0.56944602, 0.56209399, 0.54291566, 0.56611634,
       0.41747562, 0.27881285, 0.51812954, 0.12186051, 0.74927137,
       0.95293572, 0.05409649, 0.78232714, 0.22383289, 0.33641135,
       0.03353818, 0.9690858 , 0.56209561, 0.08158143, 0.32155563])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>beta_color</span></div><div class="xr-var-dims">(neuron)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">10.0 -4.0 1.0 7.0 ... -4.0 0.0 10.0</div><input id="attrs-39900a51-3cdd-4ea8-a1db-3adc4365460a" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-39900a51-3cdd-4ea8-a1db-3adc4365460a" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-acc860a1-74fb-4209-9020-042c1b513e40" class="xr-var-data-in" type="checkbox"><label for="data-acc860a1-74fb-4209-9020-042c1b513e40" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([10., -4.,  1.,  7., 10., 10., -9., -4.,  0., 10.])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>beta_size</span></div><div class="xr-var-dims">(neuron)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">7.0 1.0 -3.0 6.0 ... -3.0 8.0 6.0</div><input id="attrs-eb8bf0c6-f888-49d7-8fb9-0d90e46c5129" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-eb8bf0c6-f888-49d7-8fb9-0d90e46c5129" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-77356df9-2056-4602-b63c-138a4d5066e0" class="xr-var-data-in" type="checkbox"><label for="data-77356df9-2056-4602-b63c-138a4d5066e0" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([ 7.,  1., -3.,  6.,  1., -7.,  4., -3.,  8.,  6.])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>mean</span></div><div class="xr-var-dims">(neuron)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">0.0 -1.0 -9.0 2.0 ... -9.0 3.0 8.0</div><input id="attrs-93656a09-7af8-4fcd-8fb6-13173af2159e" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-93656a09-7af8-4fcd-8fb6-13173af2159e" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-dae9e709-8d61-4e14-a3a1-02cfbe6ed407" class="xr-var-data-in" type="checkbox"><label for="data-dae9e709-8d61-4e14-a3a1-02cfbe6ed407" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([ 0., -1., -9.,  2.,  1.,  7., -1., -9.,  3.,  8.])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>std</span></div><div class="xr-var-dims">(neuron)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">-5.0 2.0 -3.0 ... -4.0 -2.0 -8.0</div><input id="attrs-9afd79a9-3d30-447f-bd61-c590f096f259" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-9afd79a9-3d30-447f-bd61-c590f096f259" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-1ab1b5c0-34be-4d65-9aed-a2cf53217b73" class="xr-var-data-in" type="checkbox"><label for="data-1ab1b5c0-34be-4d65-9aed-a2cf53217b73" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([ -5.,   2.,  -3.,   5., -10.,  -4.,  -2.,  -4.,  -2.,  -8.])</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-98ee7fa5-fab1-4af6-b710-d7b8abd73a2d" class="xr-section-summary-in" type="checkbox"><label for="section-98ee7fa5-fab1-4af6-b710-d7b8abd73a2d" class="xr-section-summary">Indexes: <span>(2)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-index-name"><div>neuron</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-b2eae9a3-dd0b-462e-9590-786813de7371" class="xr-index-data-in" type="checkbox"><label for="index-b2eae9a3-dd0b-462e-9590-786813de7371" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([1, 2, 3, 4, 5, 6, 7, 8, 9, 10], dtype='int64', name='neuron'))</pre></div></li><li class="xr-var-item"><div class="xr-index-name"><div>stimulus</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-6c566348-5cc5-4068-add6-90c0d53ecd8d" class="xr-index-data-in" type="checkbox"><label for="index-6c566348-5cc5-4068-add6-90c0d53ecd8d" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Index([   1,    2,    3,    4,    5,    6,    7,    8,    9,   10,
       ...
        991,  992,  993,  994,  995,  996,  997,  998,  999, 1000],
      dtype='int64', name='stimulus', length=1000))</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-f99efcee-fd56-4afd-92a5-555d8e357c85" class="xr-section-summary-in" type="checkbox" disabled=""><label for="section-f99efcee-fd56-4afd-92a5-555d8e357c85" class="xr-section-summary" title="Expand/collapse section">Attributes: <span>(0)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><dl class="xr-attrs"></dl></div></li></ul></div></div>
</div>
</div>
<p>As before, we can visualize each the principal component and plot the eigenspectrum:</p>
<div id="cell-view_principal_components_big" class="cell" data-execution_count="25">
<details>
<summary>Visualize principal component scores</summary>
<div class="sourceCode cell-code" id="cell-view_principal_components_big"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cell-view_principal_components_big-1"><a href="#cell-view_principal_components_big-1" aria-hidden="true" tabindex="-1"></a>big_pca <span class="op">=</span> compute_pca(big_data)</span>
<span id="cell-view_principal_components_big-2"><a href="#cell-view_principal_components_big-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cell-view_principal_components_big-3"><a href="#cell-view_principal_components_big-3" aria-hidden="true" tabindex="-1"></a>view_individual_scatter(</span>
<span id="cell-view_principal_components_big-4"><a href="#cell-view_principal_components_big-4" aria-hidden="true" tabindex="-1"></a>    big_pca[<span class="st">"score"</span>],</span>
<span id="cell-view_principal_components_big-5"><a href="#cell-view_principal_components_big-5" aria-hidden="true" tabindex="-1"></a>    coord<span class="op">=</span><span class="st">"rank"</span>,</span>
<span id="cell-view_principal_components_big-6"><a href="#cell-view_principal_components_big-6" aria-hidden="true" tabindex="-1"></a>    dim<span class="op">=</span><span class="st">"component"</span>,</span>
<span id="cell-view_principal_components_big-7"><a href="#cell-view_principal_components_big-7" aria-hidden="true" tabindex="-1"></a>    template_func<span class="op">=</span><span class="kw">lambda</span> x: <span class="ss">f"principal component </span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cell-view_principal_components_big-8"><a href="#cell-view_principal_components_big-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="23">
<div id="view_principal_components_big" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="introducing_pca_files/figure-html/view_principal_components_big-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-visualize_eigenspectrum_big" class="cell" data-execution_count="26">
<details>
<summary>View eigenspectrum</summary>
<div class="sourceCode cell-code" id="cell-visualize_eigenspectrum_big"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cell-visualize_eigenspectrum_big-1"><a href="#cell-visualize_eigenspectrum_big-1" aria-hidden="true" tabindex="-1"></a>view_eigenspectrum(big_pca)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="24">
<div id="visualize_eigenspectrum_big" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="introducing_pca_files/figure-html/visualize_eigenspectrum_big-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We know by design that this data was generated from <em>2</em> latent variables – <em>color</em> and <em>size</em>. However, in real datasets with naturalistic stimuli, we often don’t know what the latent variables are! It’s common to use the eigenspectrum to estimate the latent dimensionality of the data. For instance, inspecting the eigenspectrum of our toy example tells us that the first two dimensions have much higher variance than the rest. We refer to these as the <em>effective dimensions</em>.</p>
<p>In general, there are several approaches for estimating dimensionality based on the eigenspectrum:</p>
<section id="rank-of-the-covariance-matrix" class="level4">
<h4 class="anchored" data-anchor-id="rank-of-the-covariance-matrix">Rank of the covariance matrix</h4>
<p>The <em>rank</em> of the covariance matrix – equal to the number of <em>nonzero</em> eigenvalues – would be the latent dimensionality in the ideal setting where the data has zero noise. In real data, the rank is typically equal to the ambient dimensionality (which here is the number of neurons we record from), since there is typically some variance along every dimension.</p>
<div id="8909434d" class="cell" data-execution_count="27">
<details>
<summary>Set a threshold of zero on the variance</summary>
<div class="sourceCode cell-code" id="8909434d"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="8909434d-1"><a href="#8909434d-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"rank = </span><span class="sc">{</span>(big_pca.eigenvalue <span class="op">&gt;</span> <span class="dv">0</span>)<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">.</span>values<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="8909434d-2"><a href="#8909434d-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="8909434d-3"><a href="#8909434d-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="8909434d-4"><a href="#8909434d-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> view_thresholded_eigenspectrum(pca: PCA, <span class="op">*</span>, threshold: <span class="bu">int</span> <span class="op">|</span> <span class="bu">float</span>) <span class="op">-&gt;</span> Figure:</span>
<span id="8909434d-5"><a href="#8909434d-5" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> view_eigenspectrum(pca)</span>
<span id="8909434d-6"><a href="#8909434d-6" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> fig.get_axes()[<span class="dv">0</span>]</span>
<span id="8909434d-7"><a href="#8909434d-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="8909434d-8"><a href="#8909434d-8" aria-hidden="true" tabindex="-1"></a>    ax.axhline(threshold, ls<span class="op">=</span><span class="st">"--"</span>, c<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="8909434d-9"><a href="#8909434d-9" aria-hidden="true" tabindex="-1"></a>    xlim <span class="op">=</span> ax.get_xlim()</span>
<span id="8909434d-10"><a href="#8909434d-10" aria-hidden="true" tabindex="-1"></a>    ylim <span class="op">=</span> ax.get_ylim()</span>
<span id="8909434d-11"><a href="#8909434d-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="8909434d-12"><a href="#8909434d-12" aria-hidden="true" tabindex="-1"></a>    ax.fill_between(x<span class="op">=</span>xlim, y1<span class="op">=</span>ylim[<span class="op">-</span><span class="dv">1</span>], y2<span class="op">=</span>threshold, color<span class="op">=</span><span class="st">"green"</span>, alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="8909434d-13"><a href="#8909434d-13" aria-hidden="true" tabindex="-1"></a>    ax.fill_between(x<span class="op">=</span>xlim, y1<span class="op">=</span>ylim[<span class="dv">0</span>], y2<span class="op">=</span>threshold, color<span class="op">=</span><span class="st">"red"</span>, alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="8909434d-14"><a href="#8909434d-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="8909434d-15"><a href="#8909434d-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="8909434d-16"><a href="#8909434d-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="8909434d-17"><a href="#8909434d-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="8909434d-18"><a href="#8909434d-18" aria-hidden="true" tabindex="-1"></a>view_thresholded_eigenspectrum(big_pca, threshold<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>rank = 10</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="25">
<p><img src="introducing_pca_files/figure-html/cell-27-output-2.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="setting-an-arbitrary-variance-threshold" class="level4">
<h4 class="anchored" data-anchor-id="setting-an-arbitrary-variance-threshold">Setting an arbitrary variance threshold</h4>
<p>Though not typically used today, another approach is to set an arbitrary threshold on the variance (historically recommended as <span class="math inline">1</span> for normalized data); only dimensions with variance above that threshold are considered useful.</p>
<div id="6e2ee9a7" class="cell" data-execution_count="28">
<details>
<summary>Set an arbitrary positive threshold on the variance</summary>
<div class="sourceCode cell-code" id="6e2ee9a7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="6e2ee9a7-1"><a href="#6e2ee9a7-1" aria-hidden="true" tabindex="-1"></a>view_thresholded_eigenspectrum(big_pca, threshold<span class="op">=</span><span class="dv">150</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="26">
<p><img src="introducing_pca_files/figure-html/cell-28-output-1.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="setting-an-arbitrary-cumulative-variance-threshold" class="level4">
<h4 class="anchored" data-anchor-id="setting-an-arbitrary-cumulative-variance-threshold">Setting an arbitrary <em>cumulative</em> variance threshold</h4>
<p>A very commonly used method is to set a threshold based on the cumulative variance of the data: the number of dimensions required to exceed, say <span class="math inline">80\%</span> of the variance, is taken as the latent dimensionality.</p>
<div id="088655d0" class="cell" data-execution_count="29">
<details>
<summary>Set an arbitrary threshold on the cumulative variance</summary>
<div class="sourceCode cell-code" id="088655d0"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="088655d0-1"><a href="#088655d0-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> view_cumulative_eigenspectrum(</span>
<span id="088655d0-2"><a href="#088655d0-2" aria-hidden="true" tabindex="-1"></a>    pca: xr.DataArray, <span class="op">*</span>, threshold: <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.8</span></span>
<span id="088655d0-3"><a href="#088655d0-3" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> Figure:</span>
<span id="088655d0-4"><a href="#088655d0-4" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(pca.sizes[<span class="st">"component"</span>], <span class="dv">5</span>))</span>
<span id="088655d0-5"><a href="#088655d0-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="088655d0-6"><a href="#088655d0-6" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> pca[<span class="st">"eigenvalue"</span>].copy()</span>
<span id="088655d0-7"><a href="#088655d0-7" aria-hidden="true" tabindex="-1"></a>    data[<span class="st">"eigenvalue"</span>] <span class="op">=</span> data.cumsum()</span>
<span id="088655d0-8"><a href="#088655d0-8" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> data.rename({<span class="st">"eigenvalue"</span>: <span class="st">"cumulative variance"</span>})</span>
<span id="088655d0-9"><a href="#088655d0-9" aria-hidden="true" tabindex="-1"></a>    data[<span class="st">"cumulative proportion of variance"</span>] <span class="op">=</span> (</span>
<span id="088655d0-10"><a href="#088655d0-10" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">"cumulative variance"</span>] <span class="op">/</span> pca[<span class="st">"eigenvalue"</span>].<span class="bu">sum</span>()</span>
<span id="088655d0-11"><a href="#088655d0-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="088655d0-12"><a href="#088655d0-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="088655d0-13"><a href="#088655d0-13" aria-hidden="true" tabindex="-1"></a>    sns.lineplot(</span>
<span id="088655d0-14"><a href="#088655d0-14" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>ax,</span>
<span id="088655d0-15"><a href="#088655d0-15" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>data.to_dataframe(),</span>
<span id="088655d0-16"><a href="#088655d0-16" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"rank"</span>,</span>
<span id="088655d0-17"><a href="#088655d0-17" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"cumulative variance"</span>,</span>
<span id="088655d0-18"><a href="#088655d0-18" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="st">"s"</span>,</span>
<span id="088655d0-19"><a href="#088655d0-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="088655d0-20"><a href="#088655d0-20" aria-hidden="true" tabindex="-1"></a>    ax.set_xticks(pca[<span class="st">"rank"</span>].values)</span>
<span id="088655d0-21"><a href="#088655d0-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="088655d0-22"><a href="#088655d0-22" aria-hidden="true" tabindex="-1"></a>    ax_twin <span class="op">=</span> ax.twinx()</span>
<span id="088655d0-23"><a href="#088655d0-23" aria-hidden="true" tabindex="-1"></a>    ax_twin.set_ylabel(<span class="st">"cumulative proportion of variance"</span>)</span>
<span id="088655d0-24"><a href="#088655d0-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="088655d0-25"><a href="#088655d0-25" aria-hidden="true" tabindex="-1"></a>    ax_twin.axhline(threshold, ls<span class="op">=</span><span class="st">"--"</span>, c<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="088655d0-26"><a href="#088655d0-26" aria-hidden="true" tabindex="-1"></a>    xlim <span class="op">=</span> ax_twin.get_xlim()</span>
<span id="088655d0-27"><a href="#088655d0-27" aria-hidden="true" tabindex="-1"></a>    ylim <span class="op">=</span> ax_twin.get_ylim()</span>
<span id="088655d0-28"><a href="#088655d0-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="088655d0-29"><a href="#088655d0-29" aria-hidden="true" tabindex="-1"></a>    ax_twin.fill_between(x<span class="op">=</span>xlim, y1<span class="op">=</span>ylim[<span class="op">-</span><span class="dv">1</span>], y2<span class="op">=</span>threshold, color<span class="op">=</span><span class="st">"red"</span>, alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="088655d0-30"><a href="#088655d0-30" aria-hidden="true" tabindex="-1"></a>    ax_twin.fill_between(x<span class="op">=</span>xlim, y1<span class="op">=</span>ylim[<span class="dv">0</span>], y2<span class="op">=</span>threshold, color<span class="op">=</span><span class="st">"green"</span>, alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="088655d0-31"><a href="#088655d0-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="088655d0-32"><a href="#088655d0-32" aria-hidden="true" tabindex="-1"></a>    sns.despine(ax<span class="op">=</span>ax, offset<span class="op">=</span><span class="dv">20</span>)</span>
<span id="088655d0-33"><a href="#088655d0-33" aria-hidden="true" tabindex="-1"></a>    sns.despine(ax<span class="op">=</span>ax_twin, offset<span class="op">=</span><span class="dv">20</span>, left<span class="op">=</span><span class="va">True</span>, bottom<span class="op">=</span><span class="va">True</span>, right<span class="op">=</span><span class="va">False</span>, top<span class="op">=</span><span class="va">True</span>)</span>
<span id="088655d0-34"><a href="#088655d0-34" aria-hidden="true" tabindex="-1"></a>    ax_twin.yaxis.set_major_formatter(ticker.PercentFormatter(<span class="dv">1</span>))</span>
<span id="088655d0-35"><a href="#088655d0-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="088655d0-36"><a href="#088655d0-36" aria-hidden="true" tabindex="-1"></a>    fig.tight_layout()</span>
<span id="088655d0-37"><a href="#088655d0-37" aria-hidden="true" tabindex="-1"></a>    plt.close(fig)</span>
<span id="088655d0-38"><a href="#088655d0-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="088655d0-39"><a href="#088655d0-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="088655d0-40"><a href="#088655d0-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="088655d0-41"><a href="#088655d0-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="088655d0-42"><a href="#088655d0-42" aria-hidden="true" tabindex="-1"></a>view_cumulative_eigenspectrum(big_pca)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="27">
<p><img src="introducing_pca_files/figure-html/cell-29-output-1.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="eyeballing-the-knee-of-the-spectrum" class="level4">
<h4 class="anchored" data-anchor-id="eyeballing-the-knee-of-the-spectrum">Eyeballing the “knee” of the spectrum</h4>
<p>When the number of latent dimensions is low, eigenspectra often have a sharp discontinuity (the “knee”), where a small number of dimensions have high-variance and the remainder have much have lower variance. The latent dimensionality is then taken to be the number of dimensions above this threshold determined by eye.</p>
<div id="a63c676f" class="cell" data-execution_count="30">
<details>
<summary>Plot the apparent knee of the spectrum</summary>
<div class="sourceCode cell-code" id="a63c676f"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="a63c676f-1"><a href="#a63c676f-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> view_eigenspectrum_knee(pca: PCA, <span class="op">*</span>, knee: <span class="bu">int</span>) <span class="op">-&gt;</span> Figure:</span>
<span id="a63c676f-2"><a href="#a63c676f-2" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> view_eigenspectrum(pca)</span>
<span id="a63c676f-3"><a href="#a63c676f-3" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> fig.get_axes()[<span class="dv">0</span>]</span>
<span id="a63c676f-4"><a href="#a63c676f-4" aria-hidden="true" tabindex="-1"></a>    ax.plot(</span>
<span id="a63c676f-5"><a href="#a63c676f-5" aria-hidden="true" tabindex="-1"></a>        knee,</span>
<span id="a63c676f-6"><a href="#a63c676f-6" aria-hidden="true" tabindex="-1"></a>        big_pca[<span class="st">"eigenvalue"</span>].isel({<span class="st">"component"</span>: big_pca[<span class="st">"rank"</span>] <span class="op">==</span> knee}).values,</span>
<span id="a63c676f-7"><a href="#a63c676f-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"o"</span>,</span>
<span id="a63c676f-8"><a href="#a63c676f-8" aria-hidden="true" tabindex="-1"></a>        ms<span class="op">=</span><span class="dv">30</span>,</span>
<span id="a63c676f-9"><a href="#a63c676f-9" aria-hidden="true" tabindex="-1"></a>        mec<span class="op">=</span><span class="st">"r"</span>,</span>
<span id="a63c676f-10"><a href="#a63c676f-10" aria-hidden="true" tabindex="-1"></a>        mfc<span class="op">=</span><span class="st">"none"</span>,</span>
<span id="a63c676f-11"><a href="#a63c676f-11" aria-hidden="true" tabindex="-1"></a>        mew<span class="op">=</span><span class="dv">3</span>,</span>
<span id="a63c676f-12"><a href="#a63c676f-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="a63c676f-13"><a href="#a63c676f-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="a63c676f-14"><a href="#a63c676f-14" aria-hidden="true" tabindex="-1"></a>    ax.axvline(knee, ls<span class="op">=</span><span class="st">"--"</span>, c<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="a63c676f-15"><a href="#a63c676f-15" aria-hidden="true" tabindex="-1"></a>    xlim <span class="op">=</span> ax.get_xlim()</span>
<span id="a63c676f-16"><a href="#a63c676f-16" aria-hidden="true" tabindex="-1"></a>    ylim <span class="op">=</span> ax.get_ylim()</span>
<span id="a63c676f-17"><a href="#a63c676f-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="a63c676f-18"><a href="#a63c676f-18" aria-hidden="true" tabindex="-1"></a>    ax.fill_betweenx(y<span class="op">=</span>ylim, x1<span class="op">=</span>xlim[<span class="op">-</span><span class="dv">1</span>], x2<span class="op">=</span>knee, color<span class="op">=</span><span class="st">"red"</span>, alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="a63c676f-19"><a href="#a63c676f-19" aria-hidden="true" tabindex="-1"></a>    ax.fill_betweenx(y<span class="op">=</span>ylim, x1<span class="op">=</span>xlim[<span class="dv">0</span>], x2<span class="op">=</span>knee, color<span class="op">=</span><span class="st">"green"</span>, alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="a63c676f-20"><a href="#a63c676f-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="a63c676f-21"><a href="#a63c676f-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="a63c676f-22"><a href="#a63c676f-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="a63c676f-23"><a href="#a63c676f-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="a63c676f-24"><a href="#a63c676f-24" aria-hidden="true" tabindex="-1"></a>view_eigenspectrum_knee(big_pca, knee<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="28">
<p><img src="introducing_pca_files/figure-html/cell-30-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>So far, all of the techniques discussed depend on a paramter that needs to be decided by the researcher. For instance, a cumulative threshold of 80% is an arbitrary choice, and if we decided to choose 90% instead, we would get a different number of dimensions. This is why sometimes a parameter-free estimate is preferred.</p>
</section>
<section id="computing-a-summary-statistic-over-the-entire-spectrum" class="level4">
<h4 class="anchored" data-anchor-id="computing-a-summary-statistic-over-the-entire-spectrum">Computing a summary statistic over the entire spectrum</h4>
<p>A metric such as <em>effective dimensionality</em> summarizes the spectrum using an entropy-like measure, taking into account variances along all the dimensions:</p>
<p><span class="math display">d_\text{eff}(\lambda_1, \dots \lambda_n) = \dfrac{\left( \sum_{i=1}^n \lambda_i \right)^2}{\sum_{i=1}^n \lambda_i^2}</span></p>
<div id="1023389b" class="cell" data-execution_count="31">
<details>
<summary>Compute the effective dimensionality from the spectrum</summary>
<div class="sourceCode cell-code" id="1023389b"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="1023389b-1"><a href="#1023389b-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_effective_dimensionality(eigenspectrum: np.ndarray) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="1023389b-2"><a href="#1023389b-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (np.<span class="bu">sum</span>(eigenspectrum) <span class="op">**</span> <span class="dv">2</span>) <span class="op">/</span> (eigenspectrum<span class="op">**</span><span class="dv">2</span>).<span class="bu">sum</span>()</span>
<span id="1023389b-3"><a href="#1023389b-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="1023389b-4"><a href="#1023389b-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="1023389b-5"><a href="#1023389b-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> view_effective_dimensionality_examples(pca: PCA) <span class="op">-&gt;</span> Figure:</span>
<span id="1023389b-6"><a href="#1023389b-6" aria-hidden="true" tabindex="-1"></a>    n_components <span class="op">=</span> pca.sizes[<span class="st">"component"</span>]</span>
<span id="1023389b-7"><a href="#1023389b-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="1023389b-8"><a href="#1023389b-8" aria-hidden="true" tabindex="-1"></a>    spectrum_1 <span class="op">=</span> [<span class="bu">float</span>(pca[<span class="st">"eigenvalue"</span>].mean().values)] <span class="op">*</span> n_components</span>
<span id="1023389b-9"><a href="#1023389b-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="1023389b-10"><a href="#1023389b-10" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.arange(n_components, dtype<span class="op">=</span>np.float32))</span>
<span id="1023389b-11"><a href="#1023389b-11" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">/=</span> weights.<span class="bu">sum</span>()</span>
<span id="1023389b-12"><a href="#1023389b-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="1023389b-13"><a href="#1023389b-13" aria-hidden="true" tabindex="-1"></a>    spectrum_2 <span class="op">=</span> <span class="bu">list</span>(weights <span class="op">*</span> pca[<span class="st">"eigenvalue"</span>].<span class="bu">sum</span>().values)</span>
<span id="1023389b-14"><a href="#1023389b-14" aria-hidden="true" tabindex="-1"></a>    spectrum_3 <span class="op">=</span> [<span class="bu">float</span>(pca[<span class="st">"eigenvalue"</span>].<span class="bu">sum</span>().values)] <span class="op">+</span> [<span class="dv">0</span>] <span class="op">*</span> (n_components <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="1023389b-15"><a href="#1023389b-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="1023389b-16"><a href="#1023389b-16" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> pd.DataFrame(</span>
<span id="1023389b-17"><a href="#1023389b-17" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="1023389b-18"><a href="#1023389b-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">"eigenvalue"</span>: spectrum_1 <span class="op">+</span> spectrum_2 <span class="op">+</span> spectrum_3,</span>
<span id="1023389b-19"><a href="#1023389b-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">"rank"</span>: <span class="bu">list</span>(np.tile(pca[<span class="st">"rank"</span>].values, <span class="dv">3</span>)),</span>
<span id="1023389b-20"><a href="#1023389b-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">"example"</span>: [<span class="dv">0</span>] <span class="op">*</span> n_components <span class="op">+</span> [<span class="dv">1</span>] <span class="op">*</span> n_components <span class="op">+</span> [<span class="dv">2</span>] <span class="op">*</span> n_components,</span>
<span id="1023389b-21"><a href="#1023389b-21" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="1023389b-22"><a href="#1023389b-22" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="1023389b-23"><a href="#1023389b-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># return data</span></span>
<span id="1023389b-24"><a href="#1023389b-24" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> sns.relplot(</span>
<span id="1023389b-25"><a href="#1023389b-25" aria-hidden="true" tabindex="-1"></a>        kind<span class="op">=</span><span class="st">"line"</span>,</span>
<span id="1023389b-26"><a href="#1023389b-26" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>data,</span>
<span id="1023389b-27"><a href="#1023389b-27" aria-hidden="true" tabindex="-1"></a>        col<span class="op">=</span><span class="st">"example"</span>,</span>
<span id="1023389b-28"><a href="#1023389b-28" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"rank"</span>,</span>
<span id="1023389b-29"><a href="#1023389b-29" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"eigenvalue"</span>,</span>
<span id="1023389b-30"><a href="#1023389b-30" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="st">"o"</span>,</span>
<span id="1023389b-31"><a href="#1023389b-31" aria-hidden="true" tabindex="-1"></a>        height<span class="op">=</span><span class="dv">3</span>,</span>
<span id="1023389b-32"><a href="#1023389b-32" aria-hidden="true" tabindex="-1"></a>        aspect<span class="op">=</span><span class="dv">1</span>,</span>
<span id="1023389b-33"><a href="#1023389b-33" aria-hidden="true" tabindex="-1"></a>        facet_kws<span class="op">=</span>{</span>
<span id="1023389b-34"><a href="#1023389b-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sharey"</span>: <span class="va">False</span>,</span>
<span id="1023389b-35"><a href="#1023389b-35" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="1023389b-36"><a href="#1023389b-36" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="1023389b-37"><a href="#1023389b-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="1023389b-38"><a href="#1023389b-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i_spectrum, ax <span class="kw">in</span> <span class="bu">enumerate</span>(g.axes.flat):</span>
<span id="1023389b-39"><a href="#1023389b-39" aria-hidden="true" tabindex="-1"></a>        d <span class="op">=</span> compute_effective_dimensionality(</span>
<span id="1023389b-40"><a href="#1023389b-40" aria-hidden="true" tabindex="-1"></a>            data.loc[data[<span class="st">"example"</span>] <span class="op">==</span> i_spectrum, <span class="st">"eigenvalue"</span>]</span>
<span id="1023389b-41"><a href="#1023389b-41" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="1023389b-42"><a href="#1023389b-42" aria-hidden="true" tabindex="-1"></a>        ax.set_title(<span class="st">"$d_</span><span class="sc">{eff}</span><span class="st">$"</span> <span class="op">+</span> <span class="ss">f" = </span><span class="sc">{</span>d<span class="sc">.</span><span class="bu">round</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="1023389b-43"><a href="#1023389b-43" aria-hidden="true" tabindex="-1"></a>        ax.set_xticks([<span class="dv">1</span>, <span class="dv">10</span>])</span>
<span id="1023389b-44"><a href="#1023389b-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="1023389b-45"><a href="#1023389b-45" aria-hidden="true" tabindex="-1"></a>    sns.despine(g.figure, offset<span class="op">=</span><span class="dv">10</span>)</span>
<span id="1023389b-46"><a href="#1023389b-46" aria-hidden="true" tabindex="-1"></a>    g.figure.tight_layout(w_pad<span class="op">=</span><span class="dv">2</span>)</span>
<span id="1023389b-47"><a href="#1023389b-47" aria-hidden="true" tabindex="-1"></a>    plt.close(g.figure)</span>
<span id="1023389b-48"><a href="#1023389b-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> g.figure</span>
<span id="1023389b-49"><a href="#1023389b-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="1023389b-50"><a href="#1023389b-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="1023389b-51"><a href="#1023389b-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(</span>
<span id="1023389b-52"><a href="#1023389b-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">"effective dimensionality ="</span></span>
<span id="1023389b-53"><a href="#1023389b-53" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f" </span><span class="sc">{</span>compute_effective_dimensionality(big_pca[<span class="st">'eigenvalue'</span>])<span class="sc">.</span>values<span class="sc">.</span><span class="bu">round</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="ss">"</span></span>
<span id="1023389b-54"><a href="#1023389b-54" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="1023389b-55"><a href="#1023389b-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="1023389b-56"><a href="#1023389b-56" aria-hidden="true" tabindex="-1"></a>view_effective_dimensionality_examples(big_pca)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>effective dimensionality = 2.55</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="29">
<p><img src="introducing_pca_files/figure-html/cell-31-output-2.svg" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="takeaways-and-further-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="takeaways-and-further-thoughts">Takeaways and further thoughts</h2>
<ul>
<li>PCA is a useful tool for studying the neural code and estimating the latent dimensionality of representations.</li>
<li>However, PCA focuses on how much variance is present along each dimension, and not the usefulness of the dimensions.</li>
<li>Here we used a toy example with idealized data, where the high variance dimensions are meaninful and the low variance ones are noise.</li>
<li>This may not always be the case, we could instead have high variance noise dimensions, and low variance meaningful dimensions.</li>
<li>Later in the tutorial, we will discuss more powerful techniques that can handle such problems. But before that, let’s analyze a real neuroscience dataset.</li>
</ul>
</section>
<section id="additional-notes" class="level2">
<h2 class="anchored" data-anchor-id="additional-notes">Additional notes</h2>
<section id="preprocessing-the-data" class="level3">
<h3 class="anchored" data-anchor-id="preprocessing-the-data">Preprocessing the data</h3>
<p>Before PCA, it’s often recommended to preprocess the data by Z-scoring each of the input features <span class="math inline">X</span> – ensuring that they have zero mean and unit variance:</p>
<p><span class="math display">Z = \dfrac{X - \mu}{\sigma}</span></p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
When and why should we standardize the data?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Often, PCA is applied to data where the features are fundamentally different from each other. For example, we might have a dataset where the features of interest are the prices of cars (in dollars) and their masses (in kilograms). Since these two features have different units, the variances of the features are not directly comparable – there’s no obvious way to numerically compare a variance of ($20,000)<sup>2</sup> in price and a variance of (1,000 kg)<sup>2</sup> in mass. Even if the features being compared are all the same, if they are in different units – say euros, dollars, and cents – the raw variances of the data matrix are meaningless.</p>
<p>Since PCA implicitly assumes that the variances along each dimension are comparable, we can Z-score each of the features before applying PCA to ensure that they are on a common scale.</p>
<p>Note, however, that this transformation reduces the information in the system – it is possible that the variances of the features are informative.</p>
</div>
</div>
</div>
</section>
</section>
<section id="further-reading" class="level2">
<h2 class="anchored" data-anchor-id="further-reading">Further reading</h2>
<ol type="1">
<li><a href="https://stats.stackexchange.com/a/134283">This StackOverflow answer</a> is a great explanation for how <a href="../pages/reference.html#singular-value-decomposition">singular value decomposition</a> is related to principal component analysis.</li>
<li><a href="https://doi.org/10.1080/00273171.2020.1743631">This tutorial</a> by <span class="citation" data-cites="DelGiudice2020">Giudice (<a href="#ref-DelGiudice2020" role="doc-biblioref">2020</a>)</span> on effective dimensionality provides a great overview of different notions of dimensionality and metrics to quantify it.</li>
</ol>



</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-DelGiudice2020" class="csl-entry" role="listitem">
Giudice, Marco Del. 2020. <span>“Effective Dimensionality: A Tutorial.”</span> <em>Multivariate Behavioral Research</em> 56 (3): 527–42. <a href="https://doi.org/10.1080/00273171.2020.1743631">https://doi.org/10.1080/00273171.2020.1743631</a>.
</div>
<div id="ref-Kriegeskorte2008" class="csl-entry" role="listitem">
Kriegeskorte, Nikolaus. 2008. <span>“Representational Similarity Analysis <span></span> Connecting the Branches of Systems Neuroscience.”</span> <em>Frontiers in Systems Neuroscience</em>. <a href="https://doi.org/10.3389/neuro.06.004.2008">https://doi.org/10.3389/neuro.06.004.2008</a>.
</div>
</div></section><aside id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>The eigendecomposition of a symmetric matrix <span class="math inline">X \in \mathbb{R}^{n \times n}</span> involves rewriting it as the product of three matrices <span class="math inline">X = V \Lambda V^\top</span>, where <span class="math inline">V \in \mathbb{n \times n}</span> is orthonormal and <span class="math inline">\Lambda \in \mathbb{n \times n}</span> is diagonal with non-negative entries.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Given a data matrix <span class="math inline">X \in \mathbb{R}^{n \times f}</span> containing neural responses to <span class="math inline">n</span> stimuli from <span class="math inline">f</span> neurons, the <em>auto-covariance</em> of <span class="math inline">X</span> (or simply its <em>covariance</em>) is defined as:</p>
<p><span class="math display">\text{cov}(X) = \left(\dfrac{1}{n - 1}\right) (X - \overline{X})^\top (X - \overline{X})</span></p>
<p>This is an <span class="math inline">f \times f</span> matrix where the <span class="math inline">(i, j)</span>-th element measures how much neuron <span class="math inline">i</span> covaries with neuron <span class="math inline">j</span>. If the covariance is positive, they tend to have similar activation: a stimulus that activates one neuron will tend to activate the other. If the covariance is negative, the neurons will have dissimilar activation: a stimulus that activates one neuron will likely not activate the other.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Let’s compute the covariance of the projected data <span class="math inline">\widetilde{X}</span>:</p>
<p><span class="math display">
\begin{align*}
    \text{cov}(\widetilde{X})
    &amp;= \left(\dfrac{1}{n - 1}\right) \widetilde{X}^\top \widetilde{X}\\
    &amp;= \left(\dfrac{1}{n - 1}\right) \left((X - \overline{X})V\right)^\top \left((X - \overline{X})V\right)\\
    &amp;= \left(\dfrac{1}{n - 1}\right) V^\top (X - \overline{X})^\top (X - \overline{X})V\\
    &amp;= V^\top \left(\dfrac{1}{n - 1}\right) (X - \overline{X})^\top (X - \overline{X})V\\
    &amp;= V^\top \left( V \Lambda V^\top \right) V\\
    &amp;= I \Lambda I\\
    &amp;= \Lambda
\end{align*}
</span><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>The singular value decomposition (SVD) involves rewriting a matrix <span class="math inline">X \in \mathbb{R}^{m \times n}</span> as the product of three matrices <span class="math inline">X = U \Sigma V^\top</span>, where <span class="math inline">U \in \mathbb{R}^{m \times m}</span> and <span class="math inline">V \in \mathbb{R}^{n \times n}</span> are orthonormal matrices and <span class="math inline">\Sigma \in \mathbb{R}^{m \times n}</span> is zero everywhere except potentially on its leading diagonal<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</aside></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        return container.innerHTML
      } else {
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        console.log("RESIZE");
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<script src="../site_libs/quarto-contrib/add-code-files-1.0.0/add-code-files.js"></script>
</body></html>